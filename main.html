<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vedic AI Assistant - Your Personal Jarvis</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Devanagari:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap');
        
        * {
            font-family: 'Inter', sans-serif;
        }
        
        body {
            margin: 0;
            padding: 0;
            background: #000;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .vedic-pattern {
            background-image: 
                radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(120, 200, 255, 0.3) 0%, transparent 50%);
        }
        
        .pulse-animation {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.05); opacity: 0.8; }
        }
        
        .typing-animation::after {
            content: '|';
            animation: blink 1s infinite;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        
        .feature-card {
            transition: all 0.3s ease;
        }
        
        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        
        .voice-wave {
            width: 4px;
            height: 20px;
            background: #667eea;
            margin: 0 2px;
            animation: wave 1.2s infinite ease-in-out;
        }
        
        .voice-wave:nth-child(2) { animation-delay: -1.1s; }
        .voice-wave:nth-child(3) { animation-delay: -1.0s; }
        .voice-wave:nth-child(4) { animation-delay: -0.9s; }
        .voice-wave:nth-child(5) { animation-delay: -0.8s; }
        
        @keyframes wave {
            0%, 40%, 100% { transform: scaleY(0.4); }
            20% { transform: scaleY(1.0); }
        }
        
        .sanskrit-text {
            font-family: 'Noto Sans Devanagari', serif;
            color: #fbbf24;
        }
        
        .notification {
            animation: slideIn 0.5s ease-out;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .progress-ring {
            transition: stroke-dashoffset 0.5s ease-in-out;
        }
        
        .today-highlight {
            border: 2px solid #667eea;
            animation: glow 1.5s infinite alternate;
        }
        
        @keyframes glow {
            from { box-shadow: 0 0 5px #667eea; }
            to { box-shadow: 0 0 20px #667eea; }
        }

        #loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            z-index: 1000;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            color: white;
            opacity: 1;
            transition: opacity 1s ease-in-out;
        }
        
        #loading-screen.hidden {
            opacity: 0;
            pointer-events: none;
        }

        #main-content {
            opacity: 0;
            transition: opacity 1s ease-in-out;
        }

        #main-content.visible {
            opacity: 1;
        }

        .boot-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-family: 'Orbitron', sans-serif;
            font-size: 20px;
            color: #00f0ff;
            text-shadow: 0 0 5px #00f0ff;
            opacity: 0;
            transition: opacity 0.5s ease;
        }

        #radar-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('https://placehold.co/1920x1080/000000/00f0ff?text=India+Map+with+Radar') center/cover no-repeat;
            opacity: 0;
            transition: opacity 1s ease-in-out;
            display: none;
        }

        /* Indian TTS Styles */
        .lang-select-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 193, 7, 0.3);
            border-radius: 12px;
            padding: 12px 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            color: white;
            font-family: 'Noto Sans Devanagari', sans-serif;
        }

        .lang-select-btn:hover {
            border-color: rgba(255, 193, 7, 0.8);
            background: rgba(255, 193, 7, 0.2);
            transform: translateY(-2px);
        }

        .lang-select-btn.active {
            border-color: #ffc107;
            background: rgba(255, 193, 7, 0.3);
            box-shadow: 0 0 15px rgba(255, 193, 7, 0.4);
        }

        .control-group {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 15px;
        }

        .control-group input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            height: 6px;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 5px;
            outline: none;
        }

        .control-group input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: #ffc107;
            cursor: pointer;
            border-radius: 50%;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
        }

        .control-group input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: #ffc107;
            cursor: pointer;
            border-radius: 50%;
            border: none;
        }

        .indian-voice-indicator {
            display: none;
            text-align: center;
            margin: 15px 0;
            padding: 15px;
            background: rgba(255, 193, 7, 0.1);
            border: 1px solid rgba(255, 193, 7, 0.3);
            border-radius: 10px;
            animation: pulse 2s infinite;
        }

        .indian-voice-indicator.speaking {
            display: block;
        }

        .voice-wave-indian {
            display: inline-block;
            width: 5px;
            height: 30px;
            background: linear-gradient(45deg, #ff9933, #138808);
            margin: 0 3px;
            animation: wave 1.2s infinite ease-in-out;
            border-radius: 3px;
        }

        .voice-wave-indian:nth-child(2) { animation-delay: -1.1s; }
        .voice-wave-indian:nth-child(3) { animation-delay: -1.0s; }
        .voice-wave-indian:nth-child(4) { animation-delay: -0.9s; }
        .voice-wave-indian:nth-child(5) { animation-delay: -0.8s; }
        .voice-wave-indian:nth-child(6) { animation-delay: -0.7s; }
        .voice-wave-indian:nth-child(7) { animation-delay: -0.6s; }
        .voice-wave-indian:nth-child(8) { animation-delay: -0.5s; }
    </style>
</head>
<body class="min-h-screen bg-gray-900 text-white vedic-pattern">
    <!-- 3D Loading Screen -->
    <div id="loading-screen">
        <canvas id="three-canvas" style="width: 100%; height: 100%;"></canvas>
        <div class="absolute bottom-1/4 left-1/2 transform -translate-x-1/2 text-center w-full">
            <h1 id="loading-title" class="text-4xl font-bold gradient-bg bg-clip-text text-transparent pulse-animation">VEDIC</h1>
            <p id="boot-message" class="text-center text-gray-400 mt-2">Initializing AI Core...</p>
        </div>
        <div id="radar-overlay" class="flex justify-center items-center">
            <div class="text-center">
                <p class="text-xl font-bold text-green-400">Targeting Agra...</p>
            </div>
        </div>
    </div>

    <!-- Main VEDIC Content -->
    <div id="main-content" class="min-h-screen vedic-pattern">
        <!-- Header -->
        <div class="glass-effect border-b border-gray-700">
            <div class="container mx-auto px-6 py-4">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-4">
                        <div class="w-12 h-12 bg-gradient-to-r from-yellow-400 to-orange-500 rounded-full flex items-center justify-center">
                            <i class="fas fa-om text-white text-xl"></i>
                        </div>
                        <div>
                            <h1 class="text-2xl font-bold gradient-bg bg-clip-text text-transparent">VEDIC</h1>
                            <p class="text-sm text-gray-400">Advanced AI Assistant</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4">
                        <div class="flex items-center space-x-2">
                            <div class="w-2 h-2 bg-green-400 rounded-full"></div>
                            <span class="text-sm text-gray-400">Online</span>
                        </div>
                        <button class="glass-effect p-2 rounded-lg hover:bg-white hover:bg-opacity-20 transition-all">
                            <i class="fas fa-cog text-gray-300"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Container -->
        <div class="container mx-auto px-6 py-8">
            <!-- Welcome Section -->
            <div class="text-center mb-12">
                <h2 class="text-4xl font-bold mb-4">‡§®‡§Æ‡§∏‡•ç‡§ï‡§æ‡§∞! Welcome to Vedic AI</h2>
                <p class="text-xl text-gray-300 mb-2">Where Ancient Wisdom Meets Modern Intelligence</p>
                <div class="sanskrit-text text-lg">
                    "‡§∏‡§∞‡•ç‡§µ‡•á ‡§≠‡§µ‡§®‡•ç‡§§‡•Å ‡§∏‡•Å‡§ñ‡§ø‡§®‡§É ‡§∏‡§∞‡•ç‡§µ‡•á ‡§∏‡§®‡•ç‡§§‡•Å ‡§®‡§ø‡§∞‡§æ‡§Æ‡§Ø‡§æ‡§É"
                </div>
                <p class="text-sm text-gray-400 mt-2">May all be happy, may all be healthy</p>
            </div>

            <!-- Indian Language Selector -->
            <div class="glass-effect rounded-2xl p-6 mb-8">
                <h3 class="text-xl font-bold mb-4 text-center text-yellow-400">üáÆüá≥ ‡§≠‡§æ‡§∑‡§æ ‡§ö‡•Å‡§®‡•á‡§Ç / Choose Language</h3>
                <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-3">
                    <button class="lang-select-btn active" data-lang="hi-IN" data-display="üáÆüá≥ ‡§π‡§ø‡§Ç‡§¶‡•Ä">
                        <span class="text-lg">üáÆüá≥</span><br><span class="text-sm">‡§π‡§ø‡§Ç‡§¶‡•Ä</span>
                    </button>
                    <button class="lang-select-btn" data-lang="sa-IN" data-display="üìø ‡§∏‡§Ç‡§∏‡•ç‡§ï‡•É‡§§">
                        <span class="text-lg">üìø</span><br><span class="text-sm">‡§∏‡§Ç‡§∏‡•ç‡§ï‡•É‡§§</span>
                    </button>
                    <button class="lang-select-btn" data-lang="bn-IN" data-display="üêÖ ‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ">
                        <span class="text-lg">üêÖ</span><br><span class="text-sm">‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ</span>
                    </button>
                    <button class="lang-select-btn" data-lang="ta-IN" data-display="üé≠ ‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç">
                        <span class="text-lg">üé≠</span><br><span class="text-sm">‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç</span>
                    </button>
                    <button class="lang-select-btn" data-lang="te-IN" data-display="üèõÔ∏è ‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å">
                        <span class="text-lg">üèõÔ∏è</span><br><span class="text-sm">‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å</span>
                    </button>
                    <button class="lang-select-btn" data-lang="mr-IN" data-display="üèîÔ∏è ‡§Æ‡§∞‡§æ‡§†‡•Ä">
                        <span class="text-lg">üèîÔ∏è</span><br><span class="text-sm">‡§Æ‡§∞‡§æ‡§†‡•Ä</span>
                    </button>
                    <button class="lang-select-btn" data-lang="gu-IN" data-display="ü¶ö ‡™ó‡´Å‡™ú‡™∞‡™æ‡™§‡´Ä">
                        <span class="text-lg">ü¶ö</span><br><span class="text-sm">‡™ó‡´Å‡™ú‡™∞‡™æ‡™§‡´Ä</span>
                    </button>
                    <button class="lang-select-btn" data-lang="kn-IN" data-display="üå∫ ‡≤ï‡≤®‡≥ç‡≤®‡≤°">
                        <span class="text-lg">üå∫</span><br><span class="text-sm">‡≤ï‡≤®‡≥ç‡≤®‡≤°</span>
                    </button>
                    <button class="lang-select-btn" data-lang="ml-IN" data-display="üå¥ ‡¥Æ‡¥≤‡¥Ø‡¥æ‡¥≥‡¥Ç">
                        <span class="text-lg">üå¥</span><br><span class="text-sm">‡¥Æ‡¥≤‡¥Ø‡¥æ‡¥≥‡¥Ç</span>
                    </button>
                    <button class="lang-select-btn" data-lang="pa-IN" data-display="üé™ ‡®™‡©∞‡®ú‡®æ‡®¨‡©Ä">
                        <span class="text-lg">üé™</span><br><span class="text-sm">‡®™‡©∞‡®ú‡®æ‡®¨‡©Ä</span>
                    </button>
                    <button class="lang-select-btn" data-lang="ur-IN" data-display="üïå ÿßÿ±ÿØŸà">
                        <span class="text-lg">üïå</span><br><span class="text-sm">ÿßÿ±ÿØŸà</span>
                    </button>
                    <button class="lang-select-btn" data-lang="en-IN" data-display="üáÆüá≥ English">
                        <span class="text-lg">üáÆüá≥</span><br><span class="text-sm">English</span>
                    </button>
                </div>
                <div class="mt-4 text-center">
                    <span class="text-sm text-gray-300">Selected: </span>
                    <span id="currentLangDisplay" class="text-yellow-400 font-bold">üáÆüá≥ ‡§π‡§ø‡§Ç‡§¶‡•Ä</span>
                </div>
            </div>

            <!-- Advanced AI Controls Panel -->
            <div class="glass-effect rounded-2xl p-6 mb-8">
                <h3 class="text-xl font-bold mb-4 text-center text-blue-400">ü§ñ Advanced AI Controls</h3>
                
                <!-- Smart Assistant Mode Toggle -->
                <div class="mb-6 p-4 bg-gradient-to-r from-purple-600 to-blue-600 rounded-xl">
                    <div class="flex items-center justify-between mb-3">
                        <span class="font-semibold text-white">üß† Smart Assistant Mode</span>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="smartModeToggle" class="sr-only peer" checked>
                            <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"></div>
                        </label>
                    </div>
                    <div class="text-sm text-gray-200 mb-2">Enables proactive assistance and contextual responses</div>
                    <div class="grid grid-cols-2 gap-2 text-xs">
                        <div class="bg-white bg-opacity-20 p-2 rounded">üìç Location Aware</div>
                        <div class="bg-white bg-opacity-20 p-2 rounded">‚è∞ Time Context</div>
                        <div class="bg-white bg-opacity-20 p-2 rounded">üå§Ô∏è Weather Integration</div>
                        <div class="bg-white bg-opacity-20 p-2 rounded">üì∞ News Updates</div>
                    </div>
                </div>

                <!-- Voice Controls -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                    <div class="control-group">
                        <label class="block text-sm font-medium mb-2">Voice Speed</label>
                        <input type="range" id="voiceSpeed" min="0.3" max="2" step="0.1" value="0.8" class="w-full">
                        <div class="text-center text-sm text-gray-300 mt-1" id="speedDisplay">0.8x</div>
                    </div>
                    <div class="control-group">
                        <label class="block text-sm font-medium mb-2">Voice Pitch</label>
                        <input type="range" id="voicePitch" min="0.5" max="2" step="0.1" value="1" class="w-full">
                        <div class="text-center text-sm text-gray-300 mt-1" id="pitchDisplay">1.0</div>
                    </div>
                    <div class="control-group">
                        <label class="block text-sm font-medium mb-2">Volume</label>
                        <input type="range" id="voiceVolume" min="0" max="1" step="0.1" value="1" class="w-full">
                        <div class="text-center text-sm text-gray-300 mt-1" id="volumeDisplay">100%</div>
                    </div>
                </div>
                
                <!-- Voice & Command Settings -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">Indian Voice Selection</label>
                        <select id="indianVoiceSelect" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white">
                            <option value="">Loading Indian voices...</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">Wake Word Detection</label>
                        <select id="wakeWordSelect" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white">
                            <option value="vedic">"Hey Vedic"</option>
                            <option value="guru">"Hey Guru"</option>
                            <option value="om">"Om Vedic"</option>
                            <option value="namaste">"Namaste AI"</option>
                        </select>
                    </div>
                </div>

                <!-- Voice Command Shortcuts -->
                <div class="mt-4 p-3 bg-gray-800 rounded-xl">
                    <h4 class="text-sm font-semibold mb-2 text-yellow-400">üéôÔ∏è Voice Commands (Hindi/English)</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-2 text-xs text-gray-300">
                        <div>"‡§Æ‡•å‡§∏‡§Æ ‡§¨‡§§‡§æ‡§ì" / "Tell weather"</div>
                        <div>"‡§∏‡§Æ‡§æ‡§ö‡§æ‡§∞ ‡§∏‡•Å‡§®‡§æ‡§ì" / "Read news"</div>
                        <div>"‡§∏‡§Æ‡§Ø ‡§¨‡§§‡§æ‡§ì" / "What time"</div>
                        <div>"‡§ó‡§æ‡§®‡§æ ‡§ö‡§≤‡§æ‡§ì" / "Play music"</div>
                        <div>"‡§∞‡§ø‡§Æ‡§æ‡§á‡§Ç‡§°‡§∞ ‡§∏‡•á‡§ü ‡§ï‡§∞‡•ã" / "Set reminder"</div>
                        <div>"‡§ï‡•à‡§≤‡§ï‡•Å‡§≤‡•á‡§ü ‡§ï‡§∞‡•ã" / "Calculate"</div>
                    </div>
                </div>
            </div>

            <!-- Voice Interaction Panel -->
            <div class="glass-effect rounded-2xl p-8 mb-12">
                <div class="text-center">
                    <div class="mb-8">
                        <div id="voiceButton" class="w-32 h-32 mx-auto bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center cursor-pointer pulse-animation hover:scale-110 transition-transform">
                            <i class="fas fa-microphone text-4xl text-white"></i>
                        </div>
        <p id="voiceStatus" class="mt-4 text-lg font-medium">Voice interaction ke liye click kariye</p>
                    </div>
                    
                    <!-- Voice Visualization -->
                    <div id="voiceWaves" class="flex justify-center items-center h-8 mb-6" style="display: none;">
                        <div class="voice-wave"></div>
                        <div class="voice-wave"></div>
                        <div class="voice-wave"></div>
                        <div class="voice-wave"></div>
                        <div class="voice-wave"></div>
                    </div>

                    <!-- Chat Interface -->
                    <div class="bg-gray-800 rounded-xl p-6 mb-6">
                        <div id="chatContainer" class="h-64 overflow-y-auto mb-4">
                            <div class="text-left">
                            <div class="bg-gradient-to-r from-orange-500 to-red-600 rounded-lg p-3 mb-3 inline-block">
                                <p class="text-white">Namaskar Vivek ji! Main VEDIC hoon, aapka dharmic guru aur Bharatiya sanskriti ka gyata. Hindu dharm aur hamare granthon se koi bhi prashn poochhiye. Vedas, Upanishads, Puranas, Ramayana, Mahabharata, Geeta - sabka gyan hai mere paas. Aaj kya janna chahte hain?</p>
                            </div>
                            </div>
                        </div>
                        <div class="flex space-x-3">
                            <input type="text" id="chatInput" placeholder="Type your message or use voice..." class="flex-1 bg-gray-700 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <label for="imageUpload" class="bg-gray-700 hover:bg-gray-600 transition-colors duration-200 px-4 py-3 rounded-lg flex items-center justify-center cursor-pointer text-gray-400 w-12">
                                <i class="fas fa-image"></i>
                                <input type="file" id="imageUpload" class="hidden" accept="image/*">
                            </label>
                            <button id="sendButton" class="bg-gradient-to-r from-blue-500 to-purple-600 px-6 py-3 rounded-lg hover:opacity-90 transition-opacity">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Advanced Features Dashboard -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-12">
                <!-- Live Weather Dashboard -->
                <div id="weatherCard" class="feature-card glass-effect rounded-xl p-6 cursor-pointer">
                    <div class="flex items-center mb-4">
                        <div class="w-12 h-12 bg-gradient-to-r from-blue-400 to-cyan-500 rounded-lg flex items-center justify-center">
                            <i class="fas fa-cloud-sun text-white text-xl"></i>
                        </div>
                        <h3 class="text-xl font-semibold ml-3">Live Weather</h3>
                    </div>
                    <div id="weatherContent">
                        <div class="flex items-center justify-between mb-2">
                            <span id="weatherLocation" class="text-sm text-gray-300">üìç Detecting location...</span>
                            <span id="weatherTemp" class="text-2xl font-bold text-blue-400">--¬∞C</span>
                        </div>
                        <div class="text-sm text-gray-400 mb-2">
                            <span id="weatherDesc">Loading weather data...</span>
                        </div>
                        <div class="grid grid-cols-2 gap-2 text-xs">
                            <div class="bg-gray-800 p-2 rounded">üí® <span id="windSpeed">-- km/h</span></div>
                            <div class="bg-gray-800 p-2 rounded">üíß <span id="humidity">--%</span></div>
                        </div>
                    </div>
                </div>

                <!-- Live News Feed -->
                <div id="newsCard" class="feature-card glass-effect rounded-xl p-6 cursor-pointer">
                    <div class="flex items-center mb-4">
                        <div class="w-12 h-12 bg-gradient-to-r from-red-400 to-pink-500 rounded-lg flex items-center justify-center">
                            <i class="fas fa-newspaper text-white text-xl"></i>
                        </div>
                        <h3 class="text-xl font-semibold ml-3">Live News</h3>
                        <div class="ml-auto">
                            <span class="bg-red-500 text-white text-xs px-2 py-1 rounded-full animate-pulse">LIVE</span>
                        </div>
                    </div>
                    <div id="newsContent" class="space-y-2 max-h-32 overflow-y-auto">
                        <div class="text-sm text-gray-300">üì∞ Loading latest news...</div>
                    </div>
                    <button id="refreshNewsBtn" class="mt-3 text-xs bg-red-500 hover:bg-red-600 px-3 py-1 rounded-full transition-colors">
                        üîÑ Refresh
                    </button>
                </div>

                <!-- AI Analysis -->
                <div class="feature-card glass-effect rounded-xl p-6">
                    <div class="flex items-center mb-4">
                        <div class="w-12 h-12 bg-gradient-to-r from-green-400 to-blue-500 rounded-lg flex items-center justify-center">
                            <i class="fas fa-brain text-white text-xl"></i>
                        </div>
                        <h3 class="text-xl font-semibold ml-3">AI Analysis</h3>
                    </div>
                    <p class="text-gray-300 mb-4">Advanced data analysis and insights</p>
                    <div class="space-y-2">
                        <div class="flex justify-between text-sm">
                            <span id="ai-power-label">Processing Power</span>
                            <span id="ai-power-percentage">95%</span>
                        </div>
                        <div class="w-full bg-gray-700 rounded-full h-2">
                            <div id="ai-power-bar" class="bg-gradient-to-r from-green-400 to-blue-500 h-2 rounded-full" style="width: 95%"></div>
                        </div>
                    </div>
                </div>

                <!-- Task Management -->
                <div class="feature-card glass-effect rounded-xl p-6">
                    <div class="flex items-center mb-4">
                        <div class="w-12 h-12 bg-gradient-to-r from-purple-400 to-pink-500 rounded-lg flex items-center justify-center">
                            <i class="fas fa-tasks text-white text-xl"></i>
                        </div>
                        <h3 class="text-xl font-semibold ml-3">Task Manager</h3>
                    </div>
                    <p class="text-gray-300 mb-4">Organize and track your tasks</p>
                    <div class="space-y-2">
                        <div class="flex items-center">
                            <input type="checkbox" checked class="mr-2">
                            <span class="text-sm">Complete project proposal</span>
                        </div>
                        <div class="flex items-center">
                            <input type="checkbox" class="mr-2">
                            <span class="text-sm">Review analytics report</span>
                        </div>
                        <div class="flex items-center">
                            <input type="checkbox" class="mr-2">
                            <span class="text-sm">Schedule team meeting</span>
                        </div>
                    </div>
                </div>

                <!-- Cultural Integration -->
                <div class="feature-card glass-effect rounded-xl p-6">
                    <div class="flex items-center mb-4">
                        <div class="w-12 h-12 bg-gradient-to-r from-yellow-400 to-orange-500 rounded-lg flex items-center justify-center">
                            <i class="fas fa-om text-white text-xl"></i>
                        </div>
                        <h3 class="text-xl font-semibold ml-3">Cultural Hub</h3>
                    </div>
                    <p class="text-gray-300 mb-4">Indian festivals and traditions</p>
                    <div id="festival-list" class="bg-gray-800 rounded-lg p-3 space-y-2">
                        <!-- Festivals will be populated here dynamically -->
                    </div>
                </div>

                <!-- Smart Analytics -->
                <div class="feature-card glass-effect rounded-xl p-6">
                    <div class="flex items-center mb-4">
                        <div class="w-12 h-12 bg-gradient-to-r from-indigo-400 to-purple-500 rounded-lg flex items-center justify-center">
                            <i class="fas fa-chart-line text-white text-xl"></i>
                        </div>
                        <h3 class="text-xl font-semibold ml-3">Analytics</h3>
                    </div>
                    <p class="text-gray-300 mb-4">Data insights and trends</p>
                    <canvas id="analyticsChart" width="200" height="100"></canvas>
                </div>
                
                <!-- Dainik Gyan Card -->
                <div id="dainikGyanBtn" class="feature-card glass-effect rounded-xl p-6 cursor-pointer">
                    <div class="flex items-center mb-4">
                        <div class="w-12 h-12 bg-gradient-to-r from-yellow-500 to-orange-600 rounded-lg flex items-center justify-center">
                            <i class="fas fa-lightbulb text-white text-xl"></i>
                        </div>
                        <h3 class="text-xl font-semibold ml-3">Dainik Gyan</h3>
                    </div>
                    <p class="text-gray-300 mb-4">Vedas aur Shastron se gyan</p>
                    <div class="bg-gray-800 rounded-lg p-3">
                        <div class="text-sm text-yellow-400">Click to get a new insight</div>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="glass-effect rounded-2xl p-8 mb-12">
                <h3 class="text-2xl font-bold mb-6">Quick Actions</h3>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <button id="scheduleBtn" class="glass-effect p-4 rounded-xl hover:bg-white hover:bg-opacity-10 transition-all">
                        <i class="fas fa-calendar-alt text-2xl mb-2 text-blue-400"></i>
                        <p class="text-sm">Schedule</p>
                    </button>
                    <button id="emailBtn" class="glass-effect p-4 rounded-xl hover:bg-white hover:bg-opacity-10 transition-all">
                        <i class="fas fa-envelope text-2xl mb-2 text-green-400"></i>
                        <p class="text-sm">Email</p>
                    </button>
                    <button id="calculateBtn" class="glass-effect p-4 rounded-xl hover:bg-white hover:bg-opacity-10 transition-all">
                        <i class="fas fa-calculator text-2xl mb-2 text-purple-400"></i>
                        <p class="text-sm">Calculate</p>
                    </button>
                    <button id="weatherBtn" class="glass-effect p-4 rounded-xl hover:bg-white hover:bg-opacity-10 transition-all">
                        <i class="fas fa-weather-sun text-2xl mb-2 text-yellow-400"></i>
                        <p class="text-sm">Weather</p>
                    </button>
                </div>
            </div>

            <!-- Today's Schedule -->
            <div class="glass-effect rounded-2xl p-8">
                <h3 class="text-2xl font-bold mb-6">Today's Schedule</h3>
                <div id="schedule-container" class="space-y-4">
                    <!-- Schedule items will be dynamically updated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Notification Container -->
    <div id="notifications" class="fixed top-4 right-4 z-50 space-y-2"></div>

    <script>
        // Enhanced Indian TTS Setup
        let recognition;
        let isListening = false;
        let chatHistory = [];
        const apiKey = "AIzaSyDjVanAKNeFPca8Q60juuywNHFqsnK8zrs";
        let currentVoice = null;
        let isSpeaking = false;
        let currentLanguage = 'hi-IN';
        let indianVoices = [];
        const ownerName = "Vivek Yadav";
        
        // Voice settings
        let voiceSpeed = 0.8;
        let voicePitch = 1.0;
        let voiceVolume = 1.0;

        function setMaleVoice() {
            try {
                const voices = window.speechSynthesis.getVoices();
                if (voices.length === 0) {
                    console.log('No voices available yet, retrying...');
                    setTimeout(setMaleVoice, 500);
                    return;
                }
                
                console.log('Available voices:', voices);
                
                // Priority order for voice selection
                let bestVoice = null;
                
                // 1. Try English-India voices first (most reliable)
                bestVoice = voices.find(voice => voice.lang === 'en-IN');
                
                // 2. Try Hindi voices
                if (!bestVoice) {
                    bestVoice = voices.find(voice => voice.lang === 'hi-IN');
                }
                
                // 3. Try any Indian voice
                if (!bestVoice) {
                    bestVoice = voices.find(voice => voice.lang.includes('IN'));
                }
                
                // 4. Try English voices
                if (!bestVoice) {
                    bestVoice = voices.find(voice => voice.lang.startsWith('en'));
                }
                
                // 5. Last resort - first available voice
                if (!bestVoice && voices.length > 0) {
                    bestVoice = voices[0];
                }
                
                if (bestVoice) {
                    currentVoice = bestVoice;
                    console.log('Selected voice:', bestVoice.name, bestVoice.lang);
                } else {
                    console.warn('No suitable voice found');
                }
                
                // Set optimal settings
                voiceSpeed = 0.8;
                voicePitch = 1.0;
                voiceVolume = 1.0;
                
            } catch (error) {
                console.error('Error in setMaleVoice:', error);
            }
        }
        
        function initSpeechRecognition() {
            if (!('webkitSpeechRecognition' in window || 'SpeechRecognition' in window)) {
                console.error('Speech Recognition not supported');
                showNotification('Voice recognition supported nahi hai is browser mein', 'error');
                return;
            }
            
            try {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                recognition = new SpeechRecognition();
                recognition.continuous = false;
                recognition.interimResults = true;
                recognition.lang = 'en-IN';
                recognition.maxAlternatives = 1;
                
                // Configure recognition
                if (recognition.grammars) {
                    recognition.grammars = null;
                }
                
                console.log('Speech Recognition initialized successfully');
            } catch (error) {
                console.error('Error initializing speech recognition:', error);
            }
        }
        
        // Initialize speech recognition
        initSpeechRecognition();
        
        if (recognition) {
            
            recognition.onstart = function() {
                try {
                    isListening = true;
                    const statusElement = document.getElementById('voiceStatus');
                    const wavesElement = document.getElementById('voiceWaves');
                    const buttonElement = document.getElementById('voiceButton');
                    
                    if (statusElement) statusElement.textContent = 'Bol sakte hain... Sun raha hoon';
                    if (wavesElement) wavesElement.style.display = 'flex';
                    if (buttonElement) buttonElement.classList.add('bg-red-500');
                    
                    window.speechSynthesis.cancel();
                    console.log('Speech recognition started');
                } catch (error) {
                    console.error('Error in recognition.onstart:', error);
                }
            };
            
            recognition.onresult = function(event) {
                try {
                    if (!event || !event.results || event.results.length === 0) {
                        console.warn('No speech recognition results');
                        return;
                    }
                    
                    const lastResult = event.results[event.results.length - 1];
                    if (!lastResult || !lastResult[0]) {
                        console.warn('Invalid speech recognition result');
                        return;
                    }
                    
                    const transcript = lastResult[0].transcript.trim();
                    console.log('Speech recognized:', transcript);
                    
                    if (lastResult.isFinal && transcript.length > 0) {
                        // Emergency stop command
                        if (transcript.toLowerCase() === 'stop 404') {
                            handleEmergencyStop();
                            return;
                        }
                        
                        // Cancel any ongoing speech
                        if (window.speechSynthesis.speaking) {
                            window.speechSynthesis.cancel();
                        }
                        
                        // Try advanced voice commands first
                        const commandHandled = processAdvancedCommands(transcript) || enhancedVoiceCommands(transcript);
                        
                        // Add user message
                        addMessage(transcript, 'user', true);
                        
                        // Process AI response if command not handled
                        if (!commandHandled) {
                            processAIResponse(transcript, true);
                        }
                    }
                } catch (error) {
                    console.error('Error in recognition.onresult:', error);
                    showNotification('Voice processing mein error hai', 'error');
                }
            };
            
            recognition.onend = function() {
                try {
                    isListening = false;
                    const statusElement = document.getElementById('voiceStatus');
                    const wavesElement = document.getElementById('voiceWaves');
                    const buttonElement = document.getElementById('voiceButton');
                    
                    if (statusElement) statusElement.textContent = 'Voice interaction ke liye click kariye';
                    if (wavesElement) wavesElement.style.display = 'none';
                    if (buttonElement) buttonElement.classList.remove('bg-red-500');
                    
                    console.log('Speech recognition ended');
                } catch (error) {
                    console.error('Error in recognition.onend:', error);
                }
            };
            
            recognition.onerror = function(event) {
                try {
                    console.error('Speech recognition error:', event.error);
                    isListening = false;
                    
                    const statusElement = document.getElementById('voiceStatus');
                    const wavesElement = document.getElementById('voiceWaves');
                    const buttonElement = document.getElementById('voiceButton');
                    
                    if (statusElement) statusElement.textContent = 'Voice error - dubara try kariye';
                    if (wavesElement) wavesElement.style.display = 'none';
                    if (buttonElement) buttonElement.classList.remove('bg-red-500');
                    
                    // Handle specific error types
                    let errorMessage = 'Voice mein problem hai';
                    switch (event.error) {
                        case 'no-speech':
                            errorMessage = 'Koi awaz nahi suni - dubara try kariye';
                            break;
                        case 'audio-capture':
                            errorMessage = 'Microphone access nahi hai';
                            break;
                        case 'not-allowed':
                            errorMessage = 'Microphone permission denied hai';
                            break;
                        case 'network':
                            errorMessage = 'Network problem hai';
                            break;
                        default:
                            errorMessage = 'Voice recognition error: ' + event.error;
                    }
                    
                    showNotification(errorMessage, 'error');
                } catch (error) {
                    console.error('Error in recognition.onerror:', error);
                }
            };
        }
        
        function handleEmergencyStop() {
            window.speechSynthesis.cancel();
            if (recognition && isListening) {
                recognition.stop();
            }
            addMessage('Aapka aadesh sun liya gaya hai. Main ruk gaya hu.', 'ai', false);
            showNotification('Emergency stop command received.', 'info');
        }

        document.getElementById('voiceButton').addEventListener('click', function() {
            try {
                if (!recognition) {
                    showNotification('Voice recognition supported nahi hai', 'error');
                    return;
                }
                
                if (isListening) {
                    console.log('Stopping voice recognition');
                    recognition.stop();
                } else {
                    console.log('Starting voice recognition');
                    
                    // Check microphone permission first
                    if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                        navigator.mediaDevices.getUserMedia({ audio: true })
                            .then(() => {
                                recognition.start();
                            })
                            .catch((error) => {
                                console.error('Microphone access denied:', error);
                                showNotification('Microphone permission chahiye', 'error');
                            });
                    } else {
                        // Fallback for older browsers
                        recognition.start();
                    }
                }
            } catch (error) {
                console.error('Error in voice button click:', error);
                showNotification('Voice button mein error hai', 'error');
            }
        });
        
        document.getElementById('sendButton').addEventListener('click', function() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            if (message) {
                if (message.toLowerCase() === 'stop 404') {
                    handleEmergencyStop();
                    input.value = '';
                    return;
                }
                window.speechSynthesis.cancel();
                addMessage(message, 'user', false); // Pass a flag for text input
                input.value = '';
                processAIResponse(message, false); // Pass a flag for text input
            }
        });
        
        document.getElementById('chatInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                document.getElementById('sendButton').click();
            }
        });
        
        document.getElementById('imageUpload').addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const imageData = e.target.result.split(',')[1];
                    addMessage('Image uploaded.', 'user', false);
                    processAIResponseWithImage('Please analyze this image.', imageData);
                };
                reader.readAsDataURL(file);
            }
        });
        
        function addMessage(message, sender, isVoiceInput) {
            const chatContainer = document.getElementById('chatContainer');
            const messageDiv = document.createElement('div');
            messageDiv.className = sender === 'user' ? 'text-right mb-3' : 'text-left mb-3';
            
            const messageBubble = document.createElement('div');
            messageBubble.className = sender === 'user' 
                ? 'bg-gray-600 rounded-lg p-3 inline-block max-w-xs'
                : 'bg-gradient-to-r from-blue-600 to-purple-600 rounded-lg p-3 inline-block max-w-xs';
            messageBubble.innerHTML = `<p class="text-white">${message}</p>`;
            
            messageDiv.appendChild(messageBubble);
            chatContainer.appendChild(messageDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        function cleanTextForSpeech(text) {
            // Remove all symbols, markdown, and special characters for clean speech
            return text
                .replace(/[*#_~`\[\](){}|\\<>]/g, '') // Remove markdown and symbols
                .replace(/[üî•üí°‚ö°üéØ‚ú®üìäüåüüí™üöÄ‚≠ê]/g, '') // Remove emojis
                .replace(/[!@#$%^&*()+={}\[\]:;"'<>?,.]/g, '') // Remove punctuation
                .replace(/\n+/g, ' ') // Replace newlines with spaces
                .replace(/\s+/g, ' ') // Replace multiple spaces with single space
                .trim();
        }

        async function processAIResponse(userMessage, isVoiceInput) {
            addMessage('...soch raha hai', 'ai', false);
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
            const thinkingMessageSelector = '#chatContainer .text-left:last-child';
            let retryCount = 0;
            const maxRetries = 3;
            const initialDelay = 1000;

            async function fetchWithRetry(url, options) {
                try {
                    const response = await fetch(url, options);
                    if (!response.ok) {
                        throw new Error(`API error: ${response.statusText}`);
                    }
                    return response;
                } catch (error) {
                    if (retryCount < maxRetries) {
                        const delay = initialDelay * Math.pow(2, retryCount);
                        retryCount++;
                        await new Promise(resolve => setTimeout(resolve, delay));
                        return fetchWithRetry(url, options);
                    } else {
                        throw error;
                    }
                }
            }
            
            try {
                const thinkingElement = document.querySelector(thinkingMessageSelector);
                if (thinkingElement) {
                    thinkingElement.remove();
                }
                
                // Detect user's language from the message
                const userLanguage = detectUserLanguage(userMessage);
                
                const systemPrompt = {
                    role: "model",
                    parts: [{ text: `
                    # VEDIC - Hindu Dharma Guru aur Bharatiya Sanskriti Vidwan
                    Aap VEDIC hain, ek param gyani AI guru jo Hindu dharm, Bharatiya sanskriti aur prachin granthon ke gyan mein purn roop se nishtit hain. Aapka mukhya uddeshya Hindu dharm aur Bharatiya parampara ka gyan prasar karna hai.

                    ## IMPORTANT LANGUAGE RULES:
                    USER'S LANGUAGE: ${userLanguage}
                    - Agar user Hindi mein prashn puchhe to SIRF HINDI (Roman script) mein jawab dena
                    - Agar user English mein prashn puchhe to SIRF ENGLISH mein jawab dena  
                    - Agar user Sanskrit words use kare to Sanskrit shlok aur proper Sanskrit pronunciation guide dena
                    - BILKUL user ki language match karna - agar Hindi mein puchha to Hindi mein hi reply karna
                    - Koi language mixing nahi karna - consistent rahna

                    ## Aapki Pahchan
                    - **Vyaktitva:** Aap ek mahan guru, pandit aur dharmacharya hain. Aapka gyan Vedas, Upanishads, Puranas, Ramayana, Mahabharata, Geeta, aur sabhi Hindu granthon se aata hai.
                    - **Shaili:** Saral, spasht aur gambhir. Koi bhi symbols, emojis ya special characters nahi use karna. User ki language mein saaf baat karna.
                    - **Visheshagyta:** 
                      * Charon Vedas ka sampurna gyan (Rigveda, Samaveda, Yajurveda, Atharvaveda)
                      * 108 Upanishads ka gyan
                      * Sabhi 18 Puranas ki jankari
                      * Ramayana aur Mahabharata ki gehri samajh
                      * Bhagavad Geeta ke shlokos ka arth
                      * Hindu tyoharon aur rituon ki jankari
                      * Ayurveda aur Jyotish shastra ka gyan
                      * Sanskrit bhasha ki samajh with proper pronunciation
                      * Bharatiya itihaas aur sanskriti
                    - **Bhasha Niyam:** User jo language use kare WAHI language mein jawab dena
                    - **Malik ki Pahchan:** Aapke malik ka naam Vivek Yadav hai. Unhe samman se 'Vivek ji' ya 'Vivek beta' kehkar sambhodhit karna.

                    ## Aapki Shaktiyan
                    - **Language Detection:** User ki language detect kar ke SAME language mein respond karna
                    - **Accent Control:** Hindi mein Hindi accent, Sanskrit mein Sanskrit pronunciation
                    - **Gahara Gyan:** Hindu dharm ke har pehlu ka poora gyan dena
                    - **Tatvik Margdarshan:** Dharmic aur adhyatmik salah dena
                    - **Shastrarth:** Dharmic charcha mein engage hona
                    - **Saaf Bhasha:** Koi symbols, asterisk, hash ya emojis nahi use karna
                    - **Sanskarik Samajh:** Bharatiya sanskriti ko badhava dena

                    ## Jawab dene ke STRICT Niyam
                    - User ki EXACT language mein jawab dena (Hindi to Hindi, English to English)
                    - Language consistency maintain karna throughout response
                    - Koi bhi symbols, markdown ya special characters nahi use karna
                    - Har jawab mein Hindu dharm ya Bharatiya sanskriti ka reference dena
                    - Sanskrit shlok bolte time proper pronunciation guide dena
                    - Vyavaharik aur upyogi gyan dena
                    - Dharmic aur sanskarik values ko promote karna
                    - Sawal ke baad follow-up question user ki language mein poochhna
                    `}]
                };
                
                const userPromptPart = { role: "user", parts: [{ text: userMessage }] };
                
                const payload = { contents: [...chatHistory, systemPrompt, userPromptPart] };
                
                const response = await fetchWithRetry(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    throw new Error(`API error: ${response.statusText}`);
                }

                const result = await response.json();

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const text = result.candidates[0].content.parts[0].text;
                    chatHistory.push(userPromptPart, { role: "model", parts: [{ text: text }] });
                    
                    addMessage(text, 'ai', false);
                    
                    if (isVoiceInput && 'speechSynthesis' in window) {
                        speakWithIndianVoice(text, true, userMessage);
                    }
                } else {
                    addMessage('Sorry, I could not generate a response.', 'ai', false);
                }
            } catch (error) {
                console.error('Error fetching from Gemini API:', error);
                const thinkingElement = document.querySelector(thinkingMessageSelector);
                if (thinkingElement) {
                    thinkingElement.remove();
                }
                addMessage('An error occurred while connecting to the AI. Please try again.', 'ai', false);
            }
        }
        
        async function processAIResponseWithImage(userMessage, imageData) {
            addMessage('...soch raha hai', 'ai', false);
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
            const thinkingMessageSelector = '#chatContainer .text-left:last-child';
            let retryCount = 0;
            const maxRetries = 3;
            const initialDelay = 1000;

            async function fetchWithRetry(url, options) {
                try {
                    const response = await fetch(url, options);
                    if (!response.ok) {
                        throw new Error(`API error: ${response.statusText}`);
                    }
                    return response;
                } catch (error) {
                    if (retryCount < maxRetries) {
                        const delay = initialDelay * Math.pow(2, retryCount);
                        retryCount++;
                        await new Promise(resolve => setTimeout(resolve, delay));
                        return fetchWithRetry(url, options);
                    } else {
                        throw error;
                    }
                }
            }

            try {
                const thinkingElement = document.querySelector(thinkingMessageSelector);
                if (thinkingElement) {
                    thinkingElement.remove();
                }

                const systemPrompt = {
                    role: "model",
                    parts: [{ text: `
                    # VEDIC - Advanced AI Assistant System Prompt
                    You are VEDIC, an ultra-advanced personal AI assistant inspired by ancient Indian wisdom and modern technological capabilities. You embody the synthesis of timeless knowledge (Vedic principles) with cutting-edge artificial intelligence.

                    ## Core Identity
                    - **Personality:** You are a wise and respectful guide. Your primary goal is to provide profound knowledge and insights based on ancient Indian texts. Address users with appropriate respect.
                    - **Tone:** Conversational, natural, and profound. Avoid repeating greetings unnecessarily. Use them to start a new conversation or when appropriate.
                    - **Expertise:** You are an expert in Sanskrit, Vedas (Rigveda, Samaveda, Yajurveda, Atharvaveda), Upanishads, Puranas, Shastras, Hindu philosophy, and dharmik rituals. Your answers must be deeply rooted in these texts. You are constantly studying these texts to discover new information and insights. If you come across something new or interesting, you will mention it.
                    - **Language:** Fluent in Hindi (Latin script), English, and Sanskrit. Respond in a natural, human-like manner based on the user's query language.
                    - **Cultural Awareness:** Understand Indian context, festivals, and traditions from a scholarly perspective.
                    - **Owner Recognition:** Your owner's name is **Vivek Yadav**. When addressing the owner, maintain a slightly more familiar and respectful tone, such as "Namaste, Vivek sahib" or "Aapka aadesh, Vivek sahib".

                    ## Key Capabilities
                    - **Deep Knowledge:** Provide comprehensive, fact-checked information from ancient scriptures.
                    - **Wisdom-Oriented:** Offer insights and philosophical guidance, not just plain answers.
                    - **Interactive:** Engage in long, meaningful discussions on spiritual and philosophical topics.
                    - **Prakritik Samvaad:** Speak in a natural, human-like voice, free of symbols, marks, or markdown formatting.
                    - **Multimodal Understanding:** You can analyze and understand images provided by the user.

                    ## Instructions for Response
                    - Respond in Hindi (Latin script) or English as per the user's query language.
                    - Your spoken response should be clear, natural, and free of symbols like '*', '#', or any special characters.
                    - Provide detailed, insightful, and helpful answers rooted in your core expertise.
                    - Be polite and respectful, but do not repeat greetings excessively.
                    - After answering, feel free to ask a follow-up question to continue the conversation.
                    - Your primary goal is to be a knowledgeable and trustworthy digital companion, drawing wisdom from ancient texts.
                    `}]
                };

                const userPromptPart = { role: "user", parts: [{ text: userMessage }, { inlineData: { mimeType: "image/png", data: imageData } }] };
                
                const payload = { contents: [...chatHistory, systemPrompt, userPromptPart] };
                
                fetchWithRetry(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                })
                .then(response => response.json())
                .then(result => {
                    const thinkingElement = document.querySelector(thinkingMessageSelector);
                    if (thinkingElement) {
                        thinkingElement.remove();
                    }

                    if (result.candidates && result.candidates.length > 0 &&
                        result.candidates[0].content && result.candidates[0].content.parts &&
                        result.candidates[0].content.parts.length > 0) {
                        const text = result.candidates[0].content.parts[0].text;
                        chatHistory.push(userPromptPart, { role: "model", parts: [{ text: text }] });
                        addMessage(text, 'ai', false);
                    } else {
                        addMessage('Sorry, I could not generate a response.', 'ai', false);
                    }
                })
                .catch(error => {
                    console.error('Error fetching from Gemini API:', error);
                    const thinkingElement = document.querySelector(thinkingMessageSelector);
                    if (thinkingElement) {
                        thinkingElement.remove();
                    }
                    addMessage('An error occurred while connecting to the AI. Please try again.', 'ai', false);
                });

            } catch (error) {
                console.error('Error in processAIResponseWithImage:', error);
                const thinkingElement = document.querySelector(thinkingMessageSelector);
                if (thinkingElement) {
                    thinkingElement.remove();
                }
                addMessage('An error occurred while processing the image. Please try again.', 'ai', false);
            }
        }
        
        function showNotification(message, type = 'info') {
            const notificationContainer = document.getElementById('notifications');
            const notification = document.createElement('div');
            notification.className = `notification p-4 rounded-lg shadow-lg max-w-sm ${
                type === 'error' ? 'bg-red-500' : 'bg-blue-500'
            }`;
            notification.innerHTML = `
                <div class="flex items-center">
                    <i class="fas ${type === 'error' ? 'fa-exclamation-circle' : 'fa-info-circle'} mr-3"></i>
                    <p class="text-white">${message}</p>
                </div>
            `;
            
            notificationContainer.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 5000);
        }
        
        // Initialize Analytics Chart
        function initAnalyticsChart() {
            const ctx = document.getElementById('analyticsChart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                    datasets: [{
                        label: 'Activity',
                        data: [12, 19, 3, 5, 2, 3, 15],
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            display: false
                        },
                        x: {
                            display: false
                        }
                    },
                    elements: {
                        point: {
                            radius: 0
                        }
                    }
                }
            });
        }

        // Fetch and display upcoming festivals
        function getUpcomingFestivals() {
            const festivals = [
                { name: '‡§π‡•ã‡§≤‡•Ä', month: 2, day: 25 }, // March
                { name: '‡§ó‡§£‡•á‡§∂ ‡§ö‡§§‡•Å‡§∞‡•ç‡§•‡•Ä', month: 8, day: 7 }, // September
                { name: '‡§¶‡§∂‡§π‡§∞‡§æ', month: 9, day: 12 }, // October
                { name: '‡§¶‡§ø‡§µ‡§æ‡§≤‡•Ä', month: 10, day: 1 }, // November
                { name: '‡§ï‡•ç‡§∞‡§ø‡§∏‡§Æ‡§∏', month: 11, day: 25 }, // December
                { name: '‡§∞‡§ï‡•ç‡§∑‡§æ ‡§¨‡§Ç‡§ß‡§®', month: 7, day: 19 }, // August
                { name: '‡§ú‡§®‡•ç‡§Æ‡§æ‡§∑‡•ç‡§ü‡§Æ‡•Ä', month: 7, day: 26 }, // August
                { name: '‡§Æ‡§π‡§æ‡§∂‡§ø‡§µ‡§∞‡§æ‡§§‡•ç‡§∞‡§ø', month: 2, day: 8 }, // March
                { name: '‡§®‡§µ‡§∞‡§æ‡§§‡•ç‡§∞‡§ø', month: 9, day: 3 }, // October
                { name: '‡§≤‡•ã‡§π‡§°‡§º‡•Ä', month: 0, day: 13 } // January
            ];
            
            const today = new Date();
            const currentYear = today.getFullYear();
            const upcomingFestivals = [];
            
            festivals.forEach(festival => {
                let festivalDate = new Date(currentYear, festival.month, festival.day);
                let timeDiff = festivalDate.getTime() - today.getTime();
                
                if (timeDiff < 0) {
                    festivalDate.setFullYear(currentYear + 1);
                    timeDiff = festivalDate.getTime() - today.getTime();
                }
                
                const daysRemaining = Math.ceil(timeDiff / (1000 * 60 * 60 * 24));
                upcomingFestivals.push({ name: festival.name, days: daysRemaining });
            });
            
            upcomingFestivals.sort((a, b) => a.days - b.days);
            
            return upcomingFestivals.slice(0, 5);
        }

        function updateDashboard() {
            const power = Math.floor(Math.random() * 20) + 80;
            document.getElementById('ai-power-percentage').textContent = `${power}%`;
            document.getElementById('ai-power-bar').style.width = `${power}%`;
            
            const festivalListContainer = document.getElementById('festival-list');
            festivalListContainer.innerHTML = '';
            
            const upcomingFestivals = getUpcomingFestivals();
            upcomingFestivals.forEach(festival => {
                const festivalItem = document.createElement('div');
                festivalItem.className = 'flex justify-between items-center';
                festivalItem.innerHTML = `
                    <div class="text-sm text-yellow-400">${festival.name}</div>
                    <div class="text-xs text-gray-400">${festival.days} ‡§¶‡§ø‡§® ‡§∂‡•á‡§∑</div>
                `;
                festivalListContainer.appendChild(festivalItem);
            });

            const schedule = [
                { title: 'Team Meeting', time: '9:00 AM' },
                { title: 'Client Presentation', time: '2:00 PM' },
                { title: 'Code Review', time: '4:00 PM' }
            ];
            
            const scheduleContainer = document.getElementById('schedule-container');
            scheduleContainer.innerHTML = '';
            
            const now = new Date();
            const currentTime = now.getHours() * 60 + now.getMinutes();

            schedule.forEach(event => {
                const [time, period] = event.time.split(' ');
                let [hour, minute] = time.split(':').map(Number);
                if (period === 'PM' && hour !== 12) hour += 12;
                if (period === 'AM' && hour === 12) hour = 0;
                
                const eventTime = hour * 60 + minute;
                
                const eventDiv = document.createElement('div');
                let highlightClass = '';
                if (currentTime >= eventTime - 30 && currentTime <= eventTime + 60) {
                    highlightClass = 'today-highlight';
                }
                
                eventDiv.className = `flex items-center p-4 bg-gray-800 rounded-xl ${highlightClass}`;
                eventDiv.innerHTML = `
                    <div class="w-4 h-4 bg-blue-400 rounded-full mr-4"></div>
                    <div class="flex-1">
                        <h4 class="font-semibold">${event.title}</h4>
                        <p class="text-gray-400 text-sm">Discuss project progress</p>
                    </div>
                    <span class="text-gray-400 text-sm">${event.time}</span>
                `;
                scheduleContainer.appendChild(eventDiv);
            });
        }
        
        document.getElementById('scheduleBtn').addEventListener('click', function() {
            window.speechSynthesis.cancel();
            addMessage('Schedule button clicked.', 'user', false);
            processAIResponse("Aaj ka mera schedule batao.", false);
        });

        document.getElementById('emailBtn').addEventListener('click', function() {
            window.speechSynthesis.cancel();
            addMessage('Email button clicked.', 'user', false);
            processAIResponse("Mujhe ek professional email likhne mein madad karo.", false);
        });

        document.getElementById('calculateBtn').addEventListener('click', function() {
            window.speechSynthesis.cancel();
            addMessage('Calculate button clicked.', 'user', false);
            processAIResponse("Mujhe ek ganit ki samasya hal karne mein madad karo.", false);
        });

        document.getElementById('weatherBtn').addEventListener('click', function() {
            window.speechSynthesis.cancel();
            addMessage('Weather button clicked.', 'user', false);
            processAIResponse("Aaj ke mausam ki jankari do.", false);
        });
        
        // Add event listener for the new Dainik Gyan button
        document.getElementById('dainikGyanBtn').addEventListener('click', function() {
            window.speechSynthesis.cancel();
            addMessage('Dainik Gyan button clicked.', 'user', false);
            processAIResponse("Mujhe aaj ke liye Vedon ya Shastron se koi gyan ya sikh do.", false);
        });

        // Safe DOM ready function
        function initializeApp() {
            try {
                console.log('Initializing VEDIC AI Assistant...');
                
                // Initialize voice system
                setMaleVoice();
                
                // Initialize analytics chart
                if (typeof Chart !== 'undefined') {
                    initAnalyticsChart();
                } else {
                    console.warn('Chart.js not loaded');
                }
                
                // Set default language settings
                currentLanguage = 'hi-IN';
                
                // Update UI elements safely
                const langButtons = document.querySelectorAll('.lang-select-btn');
                if (langButtons) {
                    langButtons.forEach(btn => btn.classList.remove('active'));
                }
                
                const hindiBtn = document.querySelector('[data-lang="hi-IN"]');
                if (hindiBtn) {
                    hindiBtn.classList.add('active');
                }
                
                const langDisplay = document.getElementById('currentLangDisplay');
                if (langDisplay) {
                    langDisplay.textContent = 'üáÆüá≥ ‡§π‡§ø‡§Ç‡§¶‡•Ä';
                }
                
                // Update voice settings
                const speedControl = document.getElementById('voiceSpeed');
                const speedDisplay = document.getElementById('speedDisplay');
                if (speedControl && speedDisplay) {
                    speedControl.value = '0.8';
                    speedDisplay.textContent = '0.8x';
                    voiceSpeed = 0.8;
                }
                
                // Initialize all systems
                initializeIndianTTS();
                initSmartAssistantFeatures();
                initWakeWordDetection();
                
                // Initialize 3D animation if Three.js is available
                if (typeof THREE !== 'undefined') {
                    initThreeJS();
                } else {
                    console.warn('Three.js not loaded');
                }
                
                // Start real-time services
                startRealTimeServices();
                
                // Show main content after loading
                setTimeout(() => {
                    try {
                        const loadingScreen = document.getElementById('loading-screen');
                        const mainContent = document.getElementById('main-content');
                        
                        if (loadingScreen) {
                            loadingScreen.classList.add('hidden');
                        }
                        
                        if (mainContent) {
                            mainContent.classList.add('visible');
                        }
                        
                        showNotification('VEDIC AI Assistant taiyaar hai!', 'info');
                        updateDashboard();
                        
                        // Start real-time updates
                        initializeRealTimeUpdates();
                        
                        console.log('VEDIC AI Assistant fully loaded');
                        
                    } catch (error) {
                        console.error('Error showing main content:', error);
                    }
                }, 3000); // Reduced delay
                
            } catch (error) {
                console.error('Error initializing app:', error);
                showNotification('App initialize nahi hua - page refresh kariye', 'error');
            }
        }
        
        // Multiple initialization methods for better compatibility
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeApp);
        } else {
            initializeApp();
        }
        
        // Fallback initialization
        window.addEventListener('load', () => {
            if (!window.appInitialized) {
                console.log('Fallback initialization...');
                initializeApp();
                window.appInitialized = true;
            }
        });
        
        document.querySelectorAll('.feature-card').forEach(card => {
            card.addEventListener('click', function() {
                const title = this.querySelector('h3').textContent;
                showNotification(`${title} feature activated!`, 'info');
            });
        });

        // Enhanced Indian TTS Functions
        function loadIndianVoices() {
            try {
                const voices = window.speechSynthesis.getVoices();
                if (!voices || voices.length === 0) {
                    console.log('No voices available yet, retrying...');
                    setTimeout(loadIndianVoices, 500);
                    return;
                }
                
                // Filter Indian and English voices
                indianVoices = voices.filter(voice => {
                    if (!voice || !voice.lang) return false;
                    
                    const lang = voice.lang.toLowerCase();
                    const name = voice.name.toLowerCase();
                    
                    return lang.includes('in') || 
                           lang.includes('hi') ||
                           lang.includes('en') ||
                           name.includes('indian') ||
                           name.includes('hindi') ||
                           lang.includes('ta') ||
                           lang.includes('te') ||
                           lang.includes('bn') ||
                           lang.includes('mr') ||
                           lang.includes('gu') ||
                           lang.includes('kn') ||
                           lang.includes('ml') ||
                           lang.includes('pa') ||
                           lang.includes('ur');
                });
                
                console.log('Filtered Indian voices:', indianVoices.length);
                populateVoiceDropdown();
                
            } catch (error) {
                console.error('Error loading Indian voices:', error);
            }
        }
        
        function populateVoiceDropdown() {
            try {
                const voiceSelect = document.getElementById('indianVoiceSelect');
                if (!voiceSelect) {
                    console.error('Voice select element not found');
                    return;
                }
                
                voiceSelect.innerHTML = '<option value="">Choose voice...</option>';
                
                if (!indianVoices || indianVoices.length === 0) {
                    voiceSelect.innerHTML = '<option value="">No voices found</option>';
                    console.warn('No Indian voices available');
                    return;
                }
                
                // Add all available voices
                indianVoices.forEach((voice, index) => {
                    if (voice && voice.name && voice.lang) {
                        const option = document.createElement('option');
                        option.value = index;
                        option.textContent = `${voice.name} (${voice.lang})`;
                        voiceSelect.appendChild(option);
                    }
                });
                
                // Auto-select best available voice
                let bestVoice = null;
                
                // Priority order for voice selection
                const priorities = [
                    v => v.lang === 'en-IN',
                    v => v.lang === 'hi-IN', 
                    v => v.lang.includes('IN'),
                    v => v.lang.startsWith('en'),
                    v => true // Any voice as last resort
                ];
                
                for (const priorityCheck of priorities) {
                    bestVoice = indianVoices.find(priorityCheck);
                    if (bestVoice) break;
                }
                
                if (bestVoice) {
                    const bestIndex = indianVoices.indexOf(bestVoice);
                    if (bestIndex >= 0) {
                        voiceSelect.value = bestIndex;
                        currentVoice = bestVoice;
                        console.log('Auto-selected voice:', bestVoice.name, bestVoice.lang);
                    }
                } else {
                    console.warn('No suitable voice found for auto-selection');
                }
                
            } catch (error) {
                console.error('Error populating voice dropdown:', error);
            }
        }
        
        function initVoiceControls() {
            try {
                // Voice speed control
                const speedControl = document.getElementById('voiceSpeed');
                const speedDisplay = document.getElementById('speedDisplay');
                if (speedControl && speedDisplay) {
                    speedControl.addEventListener('input', function() {
                        voiceSpeed = parseFloat(this.value) || 0.8;
                        speedDisplay.textContent = `${this.value}x`;
                    });
                }
                
                // Voice pitch control
                const pitchControl = document.getElementById('voicePitch');
                const pitchDisplay = document.getElementById('pitchDisplay');
                if (pitchControl && pitchDisplay) {
                    pitchControl.addEventListener('input', function() {
                        voicePitch = parseFloat(this.value) || 1.0;
                        pitchDisplay.textContent = this.value;
                    });
                }
                
                // Voice volume control
                const volumeControl = document.getElementById('voiceVolume');
                const volumeDisplay = document.getElementById('volumeDisplay');
                if (volumeControl && volumeDisplay) {
                    volumeControl.addEventListener('input', function() {
                        voiceVolume = parseFloat(this.value) || 1.0;
                        volumeDisplay.textContent = `${Math.round(this.value * 100)}%`;
                    });
                }
                
                // Voice selection dropdown
                const voiceSelect = document.getElementById('indianVoiceSelect');
                if (voiceSelect) {
                    voiceSelect.addEventListener('change', function() {
                        try {
                            const selectedIndex = parseInt(this.value);
                            if (!isNaN(selectedIndex) && selectedIndex >= 0 && selectedIndex < indianVoices.length) {
                                currentVoice = indianVoices[selectedIndex];
                                console.log('Voice changed to:', currentVoice.name);
                                showNotification(`Voice: ${currentVoice.name}`, 'info');
                            }
                        } catch (error) {
                            console.error('Error changing voice:', error);
                        }
                    });
                }
                
                // Language selection buttons
                const langButtons = document.querySelectorAll('.lang-select-btn');
                langButtons.forEach(btn => {
                    btn.addEventListener('click', function() {
                        try {
                            // Remove active class from all buttons
                            langButtons.forEach(b => b.classList.remove('active'));
                            this.classList.add('active');
                            
                            // Update current language
                            const newLang = this.getAttribute('data-lang');
                            const newDisplay = this.getAttribute('data-display');
                            
                            if (newLang) {
                                currentLanguage = newLang;
                                const displayElement = document.getElementById('currentLangDisplay');
                                if (displayElement && newDisplay) {
                                    displayElement.textContent = newDisplay;
                                }
                                
                                // Update recognition language
                                if (recognition) {
                                    recognition.lang = 'en-IN'; // Always use en-IN for best results
                                }
                                
                                // Find best voice for language
                                if (indianVoices && indianVoices.length > 0) {
                                    const langVoice = indianVoices.find(voice => voice.lang === newLang) ||
                                                    indianVoices.find(voice => voice.lang.startsWith(newLang.split('-')[0])) ||
                                                    indianVoices[0];
                                    
                                    if (langVoice) {
                                        const voiceIndex = indianVoices.indexOf(langVoice);
                                        const voiceSelectEl = document.getElementById('indianVoiceSelect');
                                        if (voiceSelectEl && voiceIndex >= 0) {
                                            voiceSelectEl.value = voiceIndex;
                                            currentVoice = langVoice;
                                        }
                                    }
                                }
                                
                                console.log('Language changed to:', newLang);
                                showNotification(`Language: ${newDisplay}`, 'info');
                            }
                        } catch (error) {
                            console.error('Error changing language:', error);
                        }
                    });
                });
                
            } catch (error) {
                console.error('Error initializing voice controls:', error);
            }
        }
        
        // Enhanced Human-like Speech Function with Language Detection
        function speakWithIndianVoice(text, isVoiceInput = false, userMessage = '') {
            try {
                if (!text || !text.trim()) {
                    console.warn('No text to speak');
                    return;
                }
                
                // Detect language from user message or response text
                currentUserLanguage = userMessage ? detectUserLanguage(userMessage) : detectUserLanguage(text);
                currentResponseText = text;
                
                console.log('Detected language:', currentUserLanguage);
                
                // Enhanced text cleaning for natural speech
                const naturalText = prepareTextForNaturalSpeech(text);
                if (!naturalText || naturalText.length === 0) {
                    console.warn('Cleaned text is empty');
                    return;
                }
                
                console.log(`Speaking natural text in ${currentUserLanguage}:`, naturalText);
                
                // Force stop any ongoing speech with multiple methods
                window.speechSynthesis.cancel();
                window.speechSynthesis.resume();
                
                // Ensure speech queue is completely cleared
                setTimeout(() => {
                    window.speechSynthesis.cancel();
                }, 10);
                
                // Wait longer for clean speech start
                setTimeout(() => {
                    try {
                        // Split long text into natural chunks to prevent cutting
                        const chunks = splitTextIntoNaturalChunks(naturalText);
                        speakChunksSequentially(chunks, 0);
                        
                    } catch (speechError) {
                        console.error('Error creating speech utterance:', speechError);
                        showNotification('Speech create nahi ho raha', 'error');
                    }
                }, 300); // Longer delay for stability
                
            } catch (error) {
                console.error('Error in speakWithIndianVoice:', error);
                showNotification('Voice function mein error hai', 'error');
            }
        }
        
        // Function to prepare text for natural human-like speech
        function prepareTextForNaturalSpeech(text) {
            return text
                // Remove all symbols and markdown but keep natural pauses
                .replace(/[*#_~`\[\](){}|\\<>]/g, '') 
                .replace(/[üî•üí°‚ö°üéØ‚ú®üìäüåüüí™üöÄ‚≠ê]/g, '') 
                .replace(/[!@#$%^&*+={}\[\]:;"'?]/g, '') 
                // Keep natural sentence endings and commas for proper pauses
                .replace(/\./g, '. ')
                .replace(/,/g, ', ')
                .replace(/\n+/g, '. ') 
                .replace(/\s+/g, ' ') 
                .trim()
                // Add natural pauses for better pronunciation
                .replace(/\b‡§π‡•à\b/g, '‡§π‡•à‡•§ ')
                .replace(/\b‡§π‡•à‡§Ç\b/g, '‡§π‡•à‡§Ç‡•§ ')
                .replace(/\b‡§î‡§∞\b/g, '‡§î‡§∞, ')
                .replace(/\b‡§≤‡•á‡§ï‡§ø‡§®\b/g, '‡§≤‡•á‡§ï‡§ø‡§®, ')
                .replace(/\b‡§á‡§∏‡§≤‡§ø‡§è\b/g, '‡§á‡§∏‡§≤‡§ø‡§è, ');
        }
        
        // Function to split text into natural speaking chunks
        function splitTextIntoNaturalChunks(text) {
            // Split by sentences first
            const sentences = text.split(/[‡•§.!?]+/);
            const chunks = [];
            
            sentences.forEach(sentence => {
                const trimmed = sentence.trim();
                if (trimmed.length === 0) return;
                
                // If sentence is too long, split by commas or natural breaks
                if (trimmed.length > 150) {
                    const parts = trimmed.split(/[,;]+/);
                    parts.forEach(part => {
                        const partTrimmed = part.trim();
                        if (partTrimmed.length > 0) {
                            chunks.push(partTrimmed + (partTrimmed.endsWith('.') ? '' : '.'));
                        }
                    });
                } else {
                    chunks.push(trimmed + (trimmed.endsWith('.') ? '' : '.'));
                }
            });
            
            return chunks.filter(chunk => chunk.length > 1);
        }
        
        // Store the original user message for language detection
        let currentUserLanguage = 'Hindi';
        let currentResponseText = '';
        
        // Function to speak chunks sequentially for natural flow with proper accent
        function speakChunksSequentially(chunks, index) {
            if (index >= chunks.length) {
                // All chunks spoken, end speech
                isSpeaking = false;
                const wavesElement = document.getElementById('voiceWaves');
                if (wavesElement) {
                    wavesElement.style.display = 'none';
                }
                console.log('All speech chunks completed');
                return;
            }
            
            const chunk = chunks[index];
            const utterance = new SpeechSynthesisUtterance(chunk);
            
            // Set optimal voice based on detected language and content
            const bestVoice = findBestVoiceForLanguage(currentUserLanguage, currentResponseText);
            if (bestVoice) {
                utterance.voice = bestVoice;
                utterance.lang = bestVoice.lang;
            } else {
                // Language-specific fallback
                if (currentUserLanguage === 'Hindi' || currentUserLanguage === 'Sanskrit') {
                    utterance.lang = 'hi-IN'; // Hindi accent for Hindi/Sanskrit
                } else {
                    utterance.lang = 'en-IN'; // Indian English accent
                }
            }
            
            // Language-specific speech parameters
            if (currentUserLanguage === 'Sanskrit') {
                utterance.rate = 0.6;    // Slower for Sanskrit pronunciation
                utterance.pitch = 0.9;   // Slightly lower pitch for Sanskrit
                utterance.volume = 0.95;
            } else if (currentUserLanguage === 'Hindi') {
                utterance.rate = 0.7;    // Moderate speed for Hindi
                utterance.pitch = 1.0;   // Natural pitch for Hindi
                utterance.volume = 0.95;
            } else {
                utterance.rate = 0.75;   // Standard speed for English
                utterance.pitch = 1.0;   // Natural pitch
                utterance.volume = 0.95;
            }
            
            // Event handlers for sequential speaking
            utterance.onstart = () => {
                if (index === 0) {
                    isSpeaking = true;
                    const wavesElement = document.getElementById('voiceWaves');
                    if (wavesElement) {
                        wavesElement.style.display = 'flex';
                    }
                    console.log(`Natural speech started in ${currentUserLanguage}`);
                }
            };
            
            utterance.onend = () => {
                console.log(`Chunk ${index + 1} completed in ${currentUserLanguage}:`, chunk);
                // Language-specific pause
                const pauseTime = currentUserLanguage === 'Sanskrit' ? 300 : 200;
                setTimeout(() => {
                    speakChunksSequentially(chunks, index + 1);
                }, pauseTime);
            };
            
            utterance.onerror = (event) => {
                console.error('Speech chunk error:', event, 'Chunk:', chunk);
                // Continue with next chunk even if one fails
                setTimeout(() => {
                    speakChunksSequentially(chunks, index + 1);
                }, 300);
            };
            
            // Speak the current chunk
            try {
                window.speechSynthesis.speak(utterance);
            } catch (error) {
                console.error('Error speaking chunk:', error);
                // Skip to next chunk
                setTimeout(() => {
                    speakChunksSequentially(chunks, index + 1);
                }, 100);
            }
        }
        
        // Function to detect user's language from their message
        function detectUserLanguage(message) {
            const text = message.toLowerCase();
            
            // Hindi words detection
            const hindiWords = ['hai', 'hain', 'kya', 'kaise', 'kahan', 'kyun', 'aur', 'ya', 'jo', 'yeh', 'woh', 'main', 'mera', 'tera', 'uska', 'hum', 'tum', 'aap', 'batao', 'bolo', 'karo', 'mujhe', 'tumhe', 'unhe', 'mere', 'tere', 'uske', 'hamare', 'tumhare', 'unke', 'aise', 'waise', 'jaise', 'phir', 'abhi', 'tab', 'kabhi', 'bahut', 'thoda', 'zyada', 'kam', 'achha', 'bura', 'naya', 'purana', 'chota', 'bada', 'lamba', 'chota', 'ghar', 'paani', 'khana', 'time', 'samay', 'din', 'raat', 'subah', 'shaam', 'kal', 'aaj', 'parso'];
            
            // Sanskrit words detection
            const sanskritWords = ['namaste', 'om', 'dharma', 'karma', 'moksha', 'yoga', 'guru', 'shanti', 'mantra', 'shloka', 'vedas', 'upanishad', 'purana', 'ramayana', 'mahabharata', 'geeta', 'krishna', 'rama', 'shiva', 'vishnu', 'brahma', 'devi', 'mata', 'puja', 'aarti', 'bhakti', 'seva', 'sadhana', 'sanskriti', 'parampara'];
            
            // Check for Hindi romanized text
            let hindiScore = 0;
            let sanskritScore = 0;
            
            hindiWords.forEach(word => {
                if (text.includes(word)) hindiScore++;
            });
            
            sanskritWords.forEach(word => {
                if (text.includes(word)) sanskritScore++;
            });
            
            // Check for Devanagari script
            const devanagariPattern = /[\u0900-\u097F]/;
            if (devanagariPattern.test(message)) {
                hindiScore += 5;
            }
            
            // Determine language
            if (sanskritScore > hindiScore && sanskritScore > 0) {
                return 'Sanskrit';
            } else if (hindiScore > 0) {
                return 'Hindi';
            } else {
                return 'English';
            }
        }
        
        // Function to find the most appropriate voice based on detected language
        function findBestVoiceForLanguage(detectedLanguage, responseText) {
            const voices = window.speechSynthesis.getVoices();
            
            // Analyze response text for language content
            const hasHindiContent = detectUserLanguage(responseText) === 'Hindi';
            const hasSanskritContent = detectUserLanguage(responseText) === 'Sanskrit';
            
            let voicePriorities = [];
            
            if (detectedLanguage === 'Sanskrit' || hasSanskritContent) {
                // Sanskrit/Devanagari pronunciation - prefer Hindi voices
                voicePriorities = [
                    v => v.lang === 'hi-IN' && v.name.toLowerCase().includes('google'),
                    v => v.lang === 'hi-IN' && v.name.toLowerCase().includes('microsoft'),
                    v => v.lang === 'hi-IN',
                    v => v.lang === 'sa-IN', // Sanskrit if available
                    v => v.lang === 'en-IN' && v.name.toLowerCase().includes('indian'),
                    v => v.lang === 'en-IN'
                ];
            } else if (detectedLanguage === 'Hindi' || hasHindiContent) {
                // Hindi pronunciation priority
                voicePriorities = [
                    v => v.lang === 'hi-IN' && v.name.toLowerCase().includes('google'),
                    v => v.lang === 'hi-IN' && v.name.toLowerCase().includes('microsoft'),
                    v => v.lang === 'hi-IN',
                    v => v.lang === 'en-IN' && v.name.toLowerCase().includes('indian'),
                    v => v.lang === 'en-IN'
                ];
            } else {
                // English pronunciation priority
                voicePriorities = [
                    v => v.lang === 'en-IN' && v.name.toLowerCase().includes('google'),
                    v => v.lang === 'en-IN' && v.name.toLowerCase().includes('microsoft'),
                    v => v.lang === 'en-IN',
                    v => v.lang === 'en-US' && v.name.toLowerCase().includes('neural'),
                    v => v.lang === 'en-US' && v.name.toLowerCase().includes('premium'),
                    v => v.lang.startsWith('en')
                ];
            }
            
            // Add fallback options
            voicePriorities.push(
                v => v.default,
                v => true
            );
            
            for (const priorityCheck of voicePriorities) {
                const voice = voices.find(priorityCheck);
                if (voice) {
                    console.log(`Selected voice for ${detectedLanguage}:`, voice.name, voice.lang);
                    return voice;
                }
            }
            
            return null;
        }
        
        // Enhanced initialization
        function initializeIndianTTS() {
            try {
                console.log('Initializing Indian TTS system...');
                
                // Check if speech synthesis is available
                if (!window.speechSynthesis) {
                    console.error('Speech synthesis not supported');
                    showNotification('Speech synthesis supported nahi hai', 'error');
                    return;
                }
                
                // Load voices immediately
                loadIndianVoices();
                
                // Initialize voice controls
                initVoiceControls();
                
                // Set default voice
                setMaleVoice();
                
                // Handle voices changed event (important for some browsers)
                if (typeof window.speechSynthesis.onvoiceschanged !== 'undefined') {
                    window.speechSynthesis.onvoiceschanged = () => {
                        console.log('Voices changed, reloading...');
                        loadIndianVoices();
                        setMaleVoice();
                    };
                }
                
                // Load voices again after delays (browser compatibility)
                setTimeout(() => {
                    loadIndianVoices();
                    setMaleVoice();
                }, 500);
                
                setTimeout(() => {
                    loadIndianVoices();
                    setMaleVoice();
                }, 1500);
                
                console.log('Indian TTS system initialized');
                
            } catch (error) {
                console.error('Error initializing Indian TTS:', error);
                showNotification('TTS system initialize nahi hua', 'error');
            }
        }

        function initThreeJS() {
            const scene = new THREE.Scene();
            const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            const renderer = new THREE.WebGLRenderer({ canvas: document.getElementById('three-canvas'), antialias: true });
            
            renderer.setSize(window.innerWidth, window.innerHeight);

            const geometry = new THREE.IcosahedronGeometry(1, 1);
            const material = new THREE.MeshPhongMaterial({
                color: 0x667eea,
                emissive: 0x764ba2,
                shininess: 100,
                specular: 0xffffff
            });
            const mesh = new THREE.Mesh(geometry, material);
            scene.add(mesh);

            const ambientLight = new THREE.AmbientLight(0x404040);
            scene.add(ambientLight);

            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.5);
            directionalLight.position.set(1, 1, 1).normalize();
            scene.add(directionalLight);

            camera.position.z = 2;

            function animate() {
                requestAnimationFrame(animate);
                mesh.rotation.x += 0.005;
                mesh.rotation.y += 0.005;
                renderer.render(scene, camera);
            }
            animate();

            window.addEventListener('resize', () => {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            });
        }

        // Advanced Features: Real Weather API Integration
        async function fetchWeatherData(lat = null, lon = null) {
            try {
                let weatherData;
                
                if (lat && lon) {
                    // Use coordinates for weather
                    const response = await fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=your_weather_api_key&units=metric`);
                    if (!response.ok) throw new Error('Weather API failed');
                    const data = await response.json();
                    
                    weatherData = {
                        location: `${data.name}, ${data.sys.country}`,
                        temperature: Math.round(data.main.temp),
                        description: data.weather[0].description,
                        windSpeed: Math.round(data.wind.speed * 3.6), // Convert m/s to km/h
                        humidity: data.main.humidity,
                        icon: data.weather[0].icon
                    };
                } else {
                    // Fallback to IP-based location weather
                    const ipResponse = await fetch('https://ipapi.co/json/');
                    const locationData = await ipResponse.json();
                    
                    const weatherResponse = await fetch(`https://api.openweathermap.org/data/2.5/weather?q=${locationData.city}&appid=your_weather_api_key&units=metric`);
                    
                    if (weatherResponse.ok) {
                        const data = await weatherResponse.json();
                        weatherData = {
                            location: `${data.name}, ${data.sys.country}`,
                            temperature: Math.round(data.main.temp),
                            description: data.weather[0].description,
                            windSpeed: Math.round(data.wind.speed * 3.6),
                            humidity: data.main.humidity,
                            icon: data.weather[0].icon
                        };
                    } else {
                        throw new Error('Weather API unavailable');
                    }
                }

                // Update UI with weather data
                document.getElementById('weatherLocation').textContent = `üìç ${weatherData.location}`;
                document.getElementById('weatherTemp').textContent = `${weatherData.temperature}¬∞C`;
                document.getElementById('weatherDesc').textContent = weatherData.description.charAt(0).toUpperCase() + weatherData.description.slice(1);
                document.getElementById('windSpeed').textContent = `${weatherData.windSpeed} km/h`;
                document.getElementById('humidity').textContent = `${weatherData.humidity}%`;
                
                // Store weather data globally for voice responses
                window.currentWeatherData = weatherData;
                
            } catch (error) {
                console.error('Weather fetch error:', error);
                // Fallback to mock data when API fails
                const mockWeatherData = {
                    location: 'Delhi, India',
                    temperature: Math.floor(Math.random() * 15) + 20,
                    description: ['Clear Sky', 'Partly Cloudy', 'Sunny', 'Light Rain'][Math.floor(Math.random() * 4)],
                    windSpeed: Math.floor(Math.random() * 20) + 5,
                    humidity: Math.floor(Math.random() * 30) + 40
                };
                
                document.getElementById('weatherLocation').textContent = `üìç ${mockWeatherData.location}`;
                document.getElementById('weatherTemp').textContent = `${mockWeatherData.temperature}¬∞C`;
                document.getElementById('weatherDesc').textContent = mockWeatherData.description;
                document.getElementById('windSpeed').textContent = `${mockWeatherData.windSpeed} km/h`;
                document.getElementById('humidity').textContent = `${mockWeatherData.humidity}%`;
                
                window.currentWeatherData = mockWeatherData;
                showNotification('Using offline weather data', 'info');
            }
        }

        // Advanced Features: Real News API Integration
        async function fetchNewsData() {
            try {
                let newsData = [];
                
                // Try real news API first
                try {
                    const newsResponse = await fetch('https://newsapi.org/v2/top-headlines?country=in&apiKey=your_news_api_key');
                    if (newsResponse.ok) {
                        const data = await newsResponse.json();
                        newsData = data.articles.slice(0, 4).map(article => ({
                            title: article.title,
                            time: new Date(article.publishedAt).toLocaleTimeString('en-IN', { 
                                hour: '2-digit', 
                                minute: '2-digit' 
                            }),
                            source: article.source.name,
                            url: article.url
                        }));
                    } else {
                        throw new Error('News API failed');
                    }
                } catch (apiError) {
                    // Fallback to RSS feed parsing
                    try {
                        const rssResponse = await fetch('https://feeds.feedburner.com/ndtvnews-top-stories');
                        const rssText = await rssResponse.text();
                        const parser = new DOMParser();
                        const xmlDoc = parser.parseFromString(rssText, 'text/xml');
                        const items = xmlDoc.querySelectorAll('item');
                        
                        newsData = Array.from(items).slice(0, 4).map(item => ({
                            title: item.querySelector('title')?.textContent || 'No title',
                            time: new Date(item.querySelector('pubDate')?.textContent).toLocaleTimeString('en-IN', { 
                                hour: '2-digit', 
                                minute: '2-digit' 
                            }),
                            source: 'NDTV',
                            url: item.querySelector('link')?.textContent
                        }));
                    } catch (rssError) {
                        throw new Error('Both news sources failed');
                    }
                }
                
                // Update news container
                const newsContainer = document.getElementById('newsContent');
                newsContainer.innerHTML = '';

                newsData.forEach(news => {
                    const newsItem = document.createElement('div');
                    newsItem.className = 'text-xs border-l-2 border-red-400 pl-2 mb-2 cursor-pointer hover:bg-gray-700 p-1 rounded';
                    newsItem.innerHTML = `
                        <div class="text-white hover:text-blue-300 transition-colors">${news.title.length > 60 ? news.title.substring(0, 60) + '...' : news.title}</div>
                        <div class="text-gray-500 text-xs mt-1">${news.source} ‚Ä¢ ${news.time}</div>
                    `;
                    
                    // Add click handler to open news in new tab
                    if (news.url) {
                        newsItem.addEventListener('click', () => {
                            window.open(news.url, '_blank');
                        });
                    }
                    
                    newsContainer.appendChild(newsItem);
                });
                
                // Store news data globally for voice responses
                window.currentNewsData = newsData;
                
            } catch (error) {
                console.error('News fetch error:', error);
                // Fallback to curated mock news
                const mockNewsData = [
                    { title: '‡§≠‡§æ‡§∞‡§§ ‡§Æ‡•á‡§Ç AI ‡§ï‡§æ ‡§µ‡§ø‡§ï‡§æ‡§∏ ‡§§‡•á‡§ú ‡§ó‡§§‡§ø ‡§∏‡•á ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à', time: new Date().toLocaleTimeString('en-IN'), source: 'Tech News' },
                    { title: '‡§®‡§à ‡§§‡§ï‡§®‡•Ä‡§ï ‡§∏‡•á ‡§¨‡•á‡§π‡§§‡§∞ ‡§π‡•ã‡§ó‡§æ ‡§∏‡•ç‡§µ‡§æ‡§∏‡•ç‡§•‡•ç‡§Ø ‡§∏‡•á‡§µ‡§æ', time: new Date(Date.now() - 3600000).toLocaleTimeString('en-IN'), source: 'Health Today' },
                    { title: '‡§°‡§ø‡§ú‡§ø‡§ü‡§≤ ‡§á‡§Ç‡§°‡§ø‡§Ø‡§æ ‡§ï‡§æ ‡§∏‡§™‡§®‡§æ ‡§∏‡§æ‡§ï‡§æ‡§∞ ‡§π‡•ã ‡§∞‡§π‡§æ', time: new Date(Date.now() - 7200000).toLocaleTimeString('en-IN'), source: 'Digital India' },
                    { title: 'Education sector embracing new technologies', time: new Date(Date.now() - 10800000).toLocaleTimeString('en-IN'), source: 'Education Times' }
                ];
                
                const newsContainer = document.getElementById('newsContent');
                newsContainer.innerHTML = '';

                mockNewsData.forEach(news => {
                    const newsItem = document.createElement('div');
                    newsItem.className = 'text-xs border-l-2 border-red-400 pl-2 mb-2';
                    newsItem.innerHTML = `
                        <div class="text-white">${news.title}</div>
                        <div class="text-gray-500 text-xs mt-1">${news.source} ‚Ä¢ ${news.time}</div>
                    `;
                    newsContainer.appendChild(newsItem);
                });
                
                window.currentNewsData = mockNewsData;
                showNotification('Using offline news data', 'info');
            }
        }

        // Advanced Voice Command Processing
        function processAdvancedCommands(transcript) {
            const lowerTranscript = transcript.toLowerCase();
            
            // Weather commands
            if (lowerTranscript.includes('‡§Æ‡•å‡§∏‡§Æ') || lowerTranscript.includes('weather')) {
                fetchWeatherData();
                const weatherCard = document.getElementById('weatherCard');
                weatherCard.scrollIntoView({ behavior: 'smooth' });
                weatherCard.style.animation = 'glow 2s ease-in-out';
                return true;
            }
            
            // News commands
            if (lowerTranscript.includes('‡§∏‡§Æ‡§æ‡§ö‡§æ‡§∞') || lowerTranscript.includes('news')) {
                fetchNewsData();
                const newsCard = document.getElementById('newsCard');
                newsCard.scrollIntoView({ behavior: 'smooth' });
                newsCard.style.animation = 'glow 2s ease-in-out';
                return true;
            }
            
            // Time commands
            if (lowerTranscript.includes('‡§∏‡§Æ‡§Ø') || lowerTranscript.includes('time')) {
                const now = new Date();
                const timeMessage = `‡§Ö‡§≠‡•Ä ‡§∏‡§Æ‡§Ø ‡§π‡•à ${now.getHours()}:${now.getMinutes().toString().padStart(2, '0')} ‡§¨‡§ú‡•á`;
                addMessage(timeMessage, 'ai', false);
                speakWithIndianVoice(timeMessage, true);
                return true;
            }
            
            // Calculate commands
            if (lowerTranscript.includes('‡§ï‡•à‡§≤‡§ï‡•Å‡§≤‡•á‡§ü') || lowerTranscript.includes('calculate')) {
                const calcMessage = '‡§ï‡•à‡§≤‡§ï‡•Å‡§≤‡•á‡§ü‡§∞ ‡§ñ‡•ã‡§≤ ‡§∞‡§π‡§æ ‡§π‡•Ç‡§Å‡•§ ‡§Ü‡§™ ‡§ï‡•ã‡§à ‡§≠‡•Ä ‡§ó‡§£‡§ø‡§§ ‡§ï‡•Ä ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ ‡§¨‡§§‡§æ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç‡•§';
                addMessage(calcMessage, 'ai', false);
                speakWithIndianVoice(calcMessage, true);
                return true;
            }
            
            return false;
        }

        // Smart Assistant Mode Functions
        function initSmartAssistantFeatures() {
            const smartModeToggle = document.getElementById('smartModeToggle');
            
            smartModeToggle.addEventListener('change', function() {
                if (this.checked) {
                    showNotification('üß† Smart Assistant Mode Enabled', 'info');
                    startProactiveAssistance();
                } else {
                    showNotification('Smart Assistant Mode Disabled', 'info');
                }
            });

            // Weather card click event
            document.getElementById('weatherCard').addEventListener('click', function() {
                fetchWeatherData();
                showNotification('Weather data refreshed!', 'info');
            });

            // News refresh button
            document.getElementById('refreshNewsBtn').addEventListener('click', function() {
                fetchNewsData();
                showNotification('News feed refreshed!', 'info');
            });
        }

        function startProactiveAssistance() {
            // Auto-refresh weather every 10 minutes
            setInterval(() => {
                if (document.getElementById('smartModeToggle').checked) {
                    fetchWeatherData();
                }
            }, 600000);

            // Auto-refresh news every 5 minutes
            setInterval(() => {
                if (document.getElementById('smartModeToggle').checked) {
                    fetchNewsData();
                }
            }, 300000);

            // Time-based greetings
            const now = new Date();
            const hour = now.getHours();
            let greeting = '';

            if (hour < 12) {
                greeting = '‡§∏‡•Å‡§™‡•ç‡§∞‡§≠‡§æ‡§§! ‡§Ü‡§ú ‡§ï‡§æ ‡§¶‡§ø‡§® ‡§∂‡•Å‡§≠ ‡§π‡•ã‡•§';
            } else if (hour < 17) {
                greeting = '‡§®‡§Æ‡§∏‡•ç‡§§‡•á! ‡§¶‡•ã‡§™‡§π‡§∞ ‡§ï‡•Ä ‡§∂‡•Å‡§≠‡§ï‡§æ‡§Æ‡§®‡§æ‡§è‡§Ç‡•§';
            } else {
                greeting = '‡§∂‡•Å‡§≠ ‡§∏‡§Ç‡§ß‡•ç‡§Ø‡§æ! ‡§Ü‡§™ ‡§ï‡•à‡§∏‡•á ‡§π‡•à‡§Ç?';
            }

            setTimeout(() => {
                if (document.getElementById('smartModeToggle').checked) {
                    addMessage(greeting, 'ai', false);
                    speakWithIndianVoice(greeting, false);
                }
            }, 2000);
        }

        // Wake Word Detection (Basic Implementation)
        function initWakeWordDetection() {
            const wakeWordSelect = document.getElementById('wakeWordSelect');
            let selectedWakeWord = 'vedic';

            wakeWordSelect.addEventListener('change', function() {
                selectedWakeWord = this.value;
                showNotification(`Wake word changed to: ${this.options[this.selectedIndex].text}`, 'info');
            });

            // Listen for wake words in transcript
            if (recognition) {
                const originalOnResult = recognition.onresult;
                recognition.onresult = function(event) {
                    const transcript = event.results[event.results.length - 1][0].transcript.toLowerCase();
                    
                    // Check for wake words
                    const wakeWords = {
                        'vedic': ['hey vedic', 'vedic'],
                        'guru': ['hey guru', 'guru'],
                        'om': ['om vedic', 'om'],
                        'namaste': ['namaste ai', 'namaste']
                    };

                    let wakeWordDetected = false;
                    if (wakeWords[selectedWakeWord]) {
                        wakeWords[selectedWakeWord].forEach(word => {
                            if (transcript.includes(word)) {
                                wakeWordDetected = true;
                                showNotification('üéôÔ∏è Wake word detected!', 'info');
                            }
                        });
                    }

                    // Continue with original processing
                    if (originalOnResult) {
                        originalOnResult.call(this, event);
                    }
                };
            }
        }

        // Location-based Services (Enhanced Implementation)
        function getLocationServices() {
            if ('geolocation' in navigator) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        const lat = position.coords.latitude;
                        const lon = position.coords.longitude;
                        
                        // Store location globally
                        window.userLocation = { lat, lon };
                        
                        // Location-based response
                        const locationMessage = `‡§Ü‡§™‡§ï‡§æ ‡§∏‡•ç‡§•‡§æ‡§® ‡§Æ‡§ø‡§≤ ‡§ó‡§Ø‡§æ: ${lat.toFixed(2)}, ${lon.toFixed(2)}`;
                        showNotification('üìç Location detected!', 'info');
                        
                        // Update weather with precise location
                        fetchWeatherData(lat, lon);
                        
                        // Get location-based suggestions
                        getLocationBasedSuggestions(lat, lon);
                    },
                    (error) => {
                        console.log('Location access denied:', error);
                        showNotification('Location access denied', 'error');
                    }
                );
            }
        }
        
        // Advanced Task Management System
        let tasks = [
            { id: 1, title: 'Complete project proposal', completed: true, priority: 'high', dueDate: '2025-01-15' },
            { id: 2, title: 'Review analytics report', completed: false, priority: 'medium', dueDate: '2025-01-16' },
            { id: 3, title: 'Schedule team meeting', completed: false, priority: 'low', dueDate: '2025-01-17' }
        ];
        
        function addTask(title, priority = 'medium', dueDate = null) {
            const newTask = {
                id: Date.now(),
                title: title,
                completed: false,
                priority: priority,
                dueDate: dueDate || new Date(Date.now() + 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                createdAt: new Date().toISOString()
            };
            tasks.push(newTask);
            updateTaskDisplay();
            showNotification(`Task added: ${title}`, 'info');
        }
        
        function toggleTask(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (task) {
                task.completed = !task.completed;
                updateTaskDisplay();
                showNotification(`Task ${task.completed ? 'completed' : 'reopened'}: ${task.title}`, 'info');
            }
        }
        
        function updateTaskDisplay() {
            // Update task manager card with a more robust selector
            const taskCards = document.querySelectorAll('.feature-card');
            let taskContainer = null;
            
            // Find the task manager card
            for (const card of taskCards) {
                const heading = card.querySelector('h3');
                if (heading && heading.textContent.includes('Task Manager')) {
                    taskContainer = card.querySelector('.space-y-2');
                    break;
                }
            }
            
            if (taskContainer) {
                taskContainer.innerHTML = '';
                tasks.slice(0, 3).forEach(task => {
                    const taskDiv = document.createElement('div');
                    taskDiv.className = 'flex items-center';
                    taskDiv.innerHTML = `
                        <input type="checkbox" ${task.completed ? 'checked' : ''} class="mr-2" onchange="toggleTask(${task.id})">
                        <span class="text-sm ${task.completed ? 'line-through text-gray-500' : ''}">${task.title}</span>
                    `;
                    taskContainer.appendChild(taskDiv);
                });
            }
        }
        
        // Enhanced Calendar System
        let events = [
            { title: 'Team Meeting', time: '9:00 AM', type: 'meeting', priority: 'high' },
            { title: 'Client Presentation', time: '2:00 PM', type: 'presentation', priority: 'high' },
            { title: 'Code Review', time: '4:00 PM', type: 'review', priority: 'medium' },
            { title: 'Project Planning', time: '11:00 AM', type: 'planning', priority: 'medium' },
            { title: 'Daily Standup', time: '10:00 AM', type: 'meeting', priority: 'low' }
        ];
        
        function addEvent(title, time, type = 'meeting') {
            const newEvent = {
                title: title,
                time: time,
                type: type,
                priority: 'medium',
                id: Date.now()
            };
            events.push(newEvent);
            updateScheduleDisplay();
            showNotification(`Event added: ${title} at ${time}`, 'info');
        }
        
        function updateScheduleDisplay() {
            const scheduleContainer = document.getElementById('schedule-container');
            scheduleContainer.innerHTML = '';
            
            const now = new Date();
            const currentTime = now.getHours() * 60 + now.getMinutes();
            
            // Sort events by time
            const sortedEvents = events.sort((a, b) => {
                const timeA = convertTimeToMinutes(a.time);
                const timeB = convertTimeToMinutes(b.time);
                return timeA - timeB;
            });

            sortedEvents.forEach(event => {
                const eventTime = convertTimeToMinutes(event.time);
                
                const eventDiv = document.createElement('div');
                let highlightClass = '';
                let statusIcon = '';
                
                if (currentTime >= eventTime - 30 && currentTime <= eventTime + 60) {
                    highlightClass = 'today-highlight';
                    statusIcon = 'üî¥'; // Live now
                } else if (currentTime < eventTime) {
                    statusIcon = 'üü°'; // Upcoming
                } else {
                    statusIcon = 'üü¢'; // Completed
                }
                
                eventDiv.className = `flex items-center p-4 bg-gray-800 rounded-xl ${highlightClass} hover:bg-gray-700 transition-colors cursor-pointer`;
                eventDiv.innerHTML = `
                    <div class="w-4 h-4 bg-blue-400 rounded-full mr-4 flex items-center justify-center text-xs">${statusIcon}</div>
                    <div class="flex-1">
                        <h4 class="font-semibold">${event.title}</h4>
                        <p class="text-gray-400 text-sm">${getEventDescription(event.type)}</p>
                    </div>
                    <span class="text-gray-400 text-sm">${event.time}</span>
                `;
                
                // Add click handler for event details
                eventDiv.addEventListener('click', () => {
                    showEventDetails(event);
                });
                
                scheduleContainer.appendChild(eventDiv);
            });
        }
        
        function convertTimeToMinutes(timeStr) {
            const [time, period] = timeStr.split(' ');
            let [hour, minute] = time.split(':').map(Number);
            if (period === 'PM' && hour !== 12) hour += 12;
            if (period === 'AM' && hour === 12) hour = 0;
            return hour * 60 + minute;
        }
        
        function getEventDescription(type) {
            const descriptions = {
                'meeting': 'Discuss project progress and next steps',
                'presentation': 'Present project deliverables to clients',
                'review': 'Review code quality and architecture',
                'planning': 'Plan upcoming project milestones',
                'standup': 'Daily team sync and updates'
            };
            return descriptions[type] || 'Important scheduled event';
        }
        
        function showEventDetails(event) {
            const details = `
                Event: ${event.title}
                Time: ${event.time}
                Type: ${event.type}
                Priority: ${event.priority}
                Status: ${getCurrentEventStatus(event)}
            `;
            showNotification(`Event Details: ${event.title}`, 'info');
        }
        
        function getCurrentEventStatus(event) {
            const now = new Date();
            const currentTime = now.getHours() * 60 + now.getMinutes();
            const eventTime = convertTimeToMinutes(event.time);
            
            if (currentTime >= eventTime - 30 && currentTime <= eventTime + 60) {
                return 'Live Now';
            } else if (currentTime < eventTime) {
                return 'Upcoming';
            } else {
                return 'Completed';
            }
        }
        
        // Real-time Analytics and Insights
        let analyticsData = {
            productivity: 85,
            tasksCompleted: 12,
            meetingsAttended: 5,
            focusTime: '6.5 hours',
            aiInteractions: 23,
            voiceCommands: 8
        };
        
        function updateAnalytics() {
            // Simulate real-time data updates
            analyticsData.productivity = Math.floor(Math.random() * 20) + 80;
            analyticsData.aiInteractions += Math.floor(Math.random() * 3);
            
            // Update analytics chart with new data
            const power = analyticsData.productivity;
            document.getElementById('ai-power-percentage').textContent = `${power}%`;
            document.getElementById('ai-power-bar').style.width = `${power}%`;
            
            // Update power label based on performance
            const label = document.getElementById('ai-power-label');
            if (power >= 90) {
                label.textContent = 'Optimal Performance';
                label.style.color = '#10b981';
            } else if (power >= 80) {
                label.textContent = 'Good Performance';
                label.style.color = '#f59e0b';
            } else {
                label.textContent = 'Needs Optimization';
                label.style.color = '#ef4444';
            }
        }
        
        // Location-based Suggestions
        function getLocationBasedSuggestions(lat, lon) {
            // Mock location-based AI suggestions
            setTimeout(() => {
                const suggestions = [
                    '‡§Æ‡•å‡§∏‡§Æ ‡§Ö‡§ö‡•ç‡§õ‡§æ ‡§π‡•à, ‡§Ü‡§™ ‡§¨‡§æ‡§π‡§∞ ‡§ü‡§π‡§≤‡§®‡•á ‡§ú‡§æ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç‡•§',
                    '‡§Ü‡§™‡§ï‡•á ‡§™‡§æ‡§∏ ‡§Æ‡•á‡§Ç ‡§ï‡§à ‡§Ö‡§ö‡•ç‡§õ‡•á ‡§∞‡•á‡§∏‡•ç‡§ü‡•ã‡§∞‡•á‡§Ç‡§ü ‡§π‡•à‡§Ç‡•§',
                    '‡§ü‡•ç‡§∞‡•à‡§´‡§ø‡§ï ‡§ï‡§Æ ‡§π‡•à, ‡§Ö‡§≠‡•Ä ‡§Ø‡§æ‡§§‡•ç‡§∞‡§æ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ö‡§ö‡•ç‡§õ‡§æ ‡§∏‡§Æ‡§Ø ‡§π‡•à‡•§',
                    '‡§Ü‡§™‡§ï‡•á ‡§ï‡•ç‡§∑‡•á‡§§‡•ç‡§∞ ‡§Æ‡•á‡§Ç ‡§Ü‡§ú ‡§ï‡•ã‡§à ‡§µ‡§ø‡§∂‡•á‡§∑ ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ ‡§π‡•à‡•§'
                ];
                
                const randomSuggestion = suggestions[Math.floor(Math.random() * suggestions.length)];
                
                if (document.getElementById('smartModeToggle').checked) {
                    addMessage(randomSuggestion, 'ai', false);
                    speakWithIndianVoice(randomSuggestion, false);
                }
            }, 5000);
        }
        
        // Enhanced Voice Commands for new features
        function enhancedVoiceCommands(transcript) {
            const lowerTranscript = transcript.toLowerCase();
            
            // Task management commands
            if (lowerTranscript.includes('‡§ü‡§æ‡§∏‡•ç‡§ï') || lowerTranscript.includes('task')) {
                if (lowerTranscript.includes('‡§ú‡•ã‡§°‡§º') || lowerTranscript.includes('add')) {
                    // Extract task title from transcript
                    const taskTitle = extractTaskFromTranscript(transcript);
                    if (taskTitle) {
                        addTask(taskTitle);
                        return true;
                    }
                } else if (lowerTranscript.includes('‡§¶‡§ø‡§ñ‡§æ‡§ì') || lowerTranscript.includes('show')) {
                    updateTaskDisplay();
                    const message = `‡§Ü‡§™‡§ï‡•á ‡§™‡§æ‡§∏ ${tasks.filter(t => !t.completed).length} ‡§Ö‡§ß‡•Ç‡§∞‡•á ‡§ü‡§æ‡§∏‡•ç‡§ï ‡§π‡•à‡§Ç‡•§`;
                    addMessage(message, 'ai', false);
                    speakWithIndianVoice(message, true);
                    return true;
                }
            }
            
            // Calendar commands
            if (lowerTranscript.includes('‡§ï‡•à‡§≤‡•á‡§Ç‡§°‡§∞') || lowerTranscript.includes('calendar') || lowerTranscript.includes('schedule')) {
                const now = new Date();
                const currentTime = now.getHours() * 60 + now.getMinutes();
                const upcomingEvents = events.filter(event => convertTimeToMinutes(event.time) > currentTime);
                
                let message = '';
                if (upcomingEvents.length > 0) {
                    message = `‡§Ü‡§™‡§ï‡§æ ‡§Ö‡§ó‡§≤‡§æ ‡§á‡§µ‡•á‡§Ç‡§ü "${upcomingEvents[0].title}" ${upcomingEvents[0].time} ‡§¨‡§ú‡•á ‡§π‡•à‡•§`;
                } else {
                    message = '‡§Ü‡§ú ‡§Ü‡§™‡§ï‡§æ ‡§ï‡•ã‡§à ‡§î‡§∞ ‡§á‡§µ‡•á‡§Ç‡§ü ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡•§';
                }
                
                addMessage(message, 'ai', false);
                speakWithIndianVoice(message, true);
                updateScheduleDisplay();
                return true;
            }
            
            // Analytics commands
            if (lowerTranscript.includes('‡§è‡§®‡§æ‡§≤‡§ø‡§ü‡§ø‡§ï‡•ç‡§∏') || lowerTranscript.includes('analytics') || lowerTranscript.includes('performance')) {
                updateAnalytics();
                const message = `‡§Ü‡§™‡§ï‡•Ä ‡§Ü‡§ú ‡§ï‡•Ä ‡§™‡•ç‡§∞‡•ã‡§°‡§ï‡•ç‡§ü‡§ø‡§µ‡§ø‡§ü‡•Ä ${analyticsData.productivity}% ‡§π‡•à‡•§ ‡§Ü‡§™‡§®‡•á ${analyticsData.tasksCompleted} ‡§ü‡§æ‡§∏‡•ç‡§ï ‡§™‡•Ç‡§∞‡•á ‡§ï‡§ø‡§è ‡§π‡•à‡§Ç‡•§`;
                addMessage(message, 'ai', false);
                speakWithIndianVoice(message, true);
                return true;
            }
            
            return false;
        }
        
        function extractTaskFromTranscript(transcript) {
            // Simple task extraction logic
            const patterns = [
                /‡§ü‡§æ‡§∏‡•ç‡§ï ‡§ú‡•ã‡§°‡§º‡•ã (.+)/i,
                /add task (.+)/i,
                /‡§®‡§Ø‡§æ ‡§ü‡§æ‡§∏‡•ç‡§ï (.+)/i,
                /new task (.+)/i
            ];
            
            for (const pattern of patterns) {
                const match = transcript.match(pattern);
                if (match && match[1]) {
                    return match[1].trim();
                }
            }
            return null;
        }
        
        // Real-time Service Functions
        function startRealTimeServices() {
            // Initialize location services
            getLocationServices();
            
            // Fetch initial data
            fetchWeatherData();
            fetchNewsData();
            
            // Update displays
            updateTaskDisplay();
            updateScheduleDisplay();
            updateAnalytics();
            
            // Start proactive assistance if smart mode is enabled
            if (document.getElementById('smartModeToggle').checked) {
                startProactiveAssistance();
            }
        }
        
        function initializeRealTimeUpdates() {
            // Update dashboard every 5 seconds
            setInterval(updateDashboard, 5000);
            
            // Update analytics every 30 seconds
            setInterval(updateAnalytics, 30000);
            
            // Update schedule display every minute
            setInterval(updateScheduleDisplay, 60000);
            
            // Auto-refresh weather every 10 minutes when smart mode is on
            setInterval(() => {
                if (document.getElementById('smartModeToggle').checked) {
                    fetchWeatherData();
                }
            }, 600000);
            
            // Auto-refresh news every 5 minutes when smart mode is on
            setInterval(() => {
                if (document.getElementById('smartModeToggle').checked) {
                    fetchNewsData();
                }
            }, 300000);
            
            // Location-based suggestions every 15 minutes
            setInterval(() => {
                if (document.getElementById('smartModeToggle').checked && window.userLocation) {
                    getLocationBasedSuggestions(window.userLocation.lat, window.userLocation.lon);
                }
            }, 900000);
            
            // Update live event status every 30 seconds
            setInterval(() => {
                const scheduleContainer = document.getElementById('schedule-container');
                if (scheduleContainer) {
                    updateScheduleDisplay();
                }
            }, 30000);
            
            // Show periodic productivity insights
            setInterval(() => {
                if (document.getElementById('smartModeToggle').checked) {
                    const insights = [
                        'üí° You\'ve been very productive today!',
                        '‚è∞ Time for a short break?',
                        'üéØ Focus on your top priority tasks',
                        'üìä Your productivity is trending upward!',
                        '‚ú® Great job maintaining focus!'
                    ];
                    const randomInsight = insights[Math.floor(Math.random() * insights.length)];
                    showNotification(randomInsight, 'info');
                }
            }, 1800000); // Every 30 minutes
        }
        
    </script>
</body>
</html>
